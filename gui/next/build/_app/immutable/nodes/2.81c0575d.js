import{S as ke,i as Te,s as De,k as m,a as y,y as se,q as F,l as v,m as g,c as w,z as ae,h as u,r as L,n as b,b as Y,F as a,A as le,G as ne,g as Q,d as X,B as re,V as Ie,w as xe,Q as Me,W as Re,f as Ue,R as Be,T as je,U as Ae,X as He,o as Ne,E as pe,u as te,H as Fe,v as Le}from"../chunks/index.4dc0ea79.js";import{b as ye}from"../chunks/backgroundJob.e65d305f.js";import{I as we}from"../chunks/Icon.95af7dc0.js";import{s as ge}from"../chunks/state.dc963ae5.js";const oe=e=>{const t=e instanceof Date?e:new Date(e),s=new Intl.RelativeTimeFormat("en"),n={years:3600*24*365,months:3600*24*30,weeks:3600*24*7,days:3600*24,hours:3600,minutes:60,seconds:1},o=(t.getTime()-Date.now())/1e3;for(let r in n)if(n[r]<Math.abs(o)){const f=o/n[r];return s.format(Math.round(f),r)}};function Je(e){let t,s,n,o,r,f,k,p,_,x;return f=new we({props:{icon:"x",size:"22"}}),{c(){t=m("form"),s=m("input"),n=y(),o=m("button"),r=m("i"),se(f.$$.fragment),k=F(`
    Delete background job`),this.h()},l(d){t=v(d,"FORM",{});var h=g(t);s=v(h,"INPUT",{type:!0,name:!0}),n=w(h),o=v(h,"BUTTON",{class:!0});var j=g(o);r=v(j,"I",{class:!0});var I=g(r);ae(f.$$.fragment,I),I.forEach(u),k=L(j,`
    Delete background job`),j.forEach(u),h.forEach(u),this.h()},h(){b(s,"type","hidden"),b(s,"name","id"),s.value=e[0],b(r,"class","svelte-ooaugn"),b(o,"class","danger")},m(d,h){Y(d,t,h),a(t,s),a(t,n),a(t,o),a(o,r),le(f,r,null),a(o,k),e[3](t),p=!0,_||(x=ne(t,"submit",e[2]),_=!0)},p(d,[h]){(!p||h&1)&&(s.value=d[0])},i(d){p||(Q(f.$$.fragment,d),p=!0)},o(d){X(f.$$.fragment,d),p=!1},d(d){d&&u(t),re(f),e[3](null),_=!1,x()}}}function Oe(e,t,s){let{id:n}=t,o;const r=Ie(),f=async p=>{if(p.preventDefault(),confirm("Are you sure you want to delete this background job?")){const _=await ye.delete({properties:new FormData(o)});_.errors?ge.notification.create("error",`Background job ${_.admin_background_job_delete.id} could not be deleted`):(r("itemsChanged"),ge.notification.create("success",`Background job ${_.admin_background_job_delete.id} deleted`))}};function k(p){xe[p?"unshift":"push"](()=>{o=p,s(1,o)})}return e.$$set=p=>{"id"in p&&s(0,n=p.id)},[n,o,f,k]}class Pe extends ke{constructor(t){super(),Te(this,t,Oe,Je,De,{id:0})}}function be(e,t,s){const n=e.slice();return n[8]=t[s],n}function Ee(e){let t;return{c(){t=F("Failed")},l(s){t=L(s,"Failed")},m(s,n){Y(s,t,n)},d(s){s&&u(t)}}}function $e(e){let t,s,n,o,r,f,k,p,_,x,d,h,j,I,B=(e[8].source_name||e[8].id)+"",C,V,P,J,S=e[8].arguments.priority+"",A,H,i,G=e[8].arguments.context.location.href+"",q,D,l,E=(e[8].run_at_parsed||oe(new Date(e[8].run_at)))+"",c,N,O,M,R,W,K;k=new we({props:{icon:"navigationMenuVertical",size:"16"}});function Z(){return e[5](e[8])}h=new Pe({props:{id:e[8].id}}),h.$on("itemsChanged",e[2]);let T=e[8].error&&Ee();return{c(){t=m("tr"),s=m("td"),n=m("button"),o=m("span"),r=F("More options"),f=y(),se(k.$$.fragment),p=y(),_=m("menu"),x=m("ul"),d=m("li"),se(h.$$.fragment),j=y(),I=m("a"),C=F(B),P=y(),J=m("td"),A=F(S),H=y(),i=m("td"),q=F(G),D=y(),l=m("td"),c=F(E),N=y(),O=m("td"),T&&T.c(),M=y(),this.h()},l(U){t=v(U,"TR",{class:!0});var $=g(t);s=v($,"TD",{class:!0});var z=g(s);n=v(z,"BUTTON",{class:!0});var ee=g(n);o=v(ee,"SPAN",{class:!0});var ie=g(o);r=L(ie,"More options"),ie.forEach(u),f=w(ee),ae(k.$$.fragment,ee),ee.forEach(u),p=w(z),_=v(z,"MENU",{class:!0});var ce=g(_);x=v(ce,"UL",{});var ue=g(x);d=v(ue,"LI",{});var de=g(d);ae(h.$$.fragment,de),de.forEach(u),ue.forEach(u),ce.forEach(u),j=w(z),I=v(z,"A",{href:!0,class:!0});var fe=g(I);C=L(fe,B),fe.forEach(u),z.forEach(u),P=w($),J=v($,"TD",{class:!0});var _e=g(J);A=L(_e,S),_e.forEach(u),H=w($),i=v($,"TD",{class:!0});var he=g(i);q=L(he,G),he.forEach(u),D=w($),l=v($,"TD",{class:!0});var me=g(l);c=L(me,E),me.forEach(u),N=w($),O=v($,"TD",{class:!0});var ve=g(O);T&&T.l(ve),ve.forEach(u),M=w($),$.forEach(u),this.h()},h(){b(o,"class","label"),b(n,"class","button compact more svelte-1i30xx0"),b(_,"class","content-context svelte-1i30xx0"),pe(_,"active",e[1].id===e[8].id),b(I,"href",V="/backgroundJobs/"+e[8].id),b(I,"class","svelte-1i30xx0"),b(s,"class","id svelte-1i30xx0"),b(J,"class","svelte-1i30xx0"),b(i,"class","svelte-1i30xx0"),b(l,"class","svelte-1i30xx0"),b(O,"class","svelte-1i30xx0"),b(t,"class","svelte-1i30xx0")},m(U,$){Y(U,t,$),a(t,s),a(s,n),a(n,o),a(o,r),a(n,f),le(k,n,null),a(s,p),a(s,_),a(_,x),a(x,d),le(h,d,null),a(s,j),a(s,I),a(I,C),a(t,P),a(t,J),a(J,A),a(t,H),a(t,i),a(i,q),a(t,D),a(t,l),a(l,c),a(t,N),a(t,O),T&&T.m(O,null),a(t,M),R=!0,W||(K=[ne(n,"click",Z),ne(s,"mouseleave",e[6])],W=!0)},p(U,$){e=U;const z={};$&1&&(z.id=e[8].id),h.$set(z),(!R||$&3)&&pe(_,"active",e[1].id===e[8].id),(!R||$&1)&&B!==(B=(e[8].source_name||e[8].id)+"")&&te(C,B),(!R||$&1&&V!==(V="/backgroundJobs/"+e[8].id))&&b(I,"href",V),(!R||$&1)&&S!==(S=e[8].arguments.priority+"")&&te(A,S),(!R||$&1)&&G!==(G=e[8].arguments.context.location.href+"")&&te(q,G),(!R||$&1)&&E!==(E=(e[8].run_at_parsed||oe(new Date(e[8].run_at)))+"")&&te(c,E),e[8].error?T||(T=Ee(),T.c(),T.m(O,null)):T&&(T.d(1),T=null)},i(U){R||(Q(k.$$.fragment,U),Q(h.$$.fragment,U),R=!0)},o(U){X(k.$$.fragment,U),X(h.$$.fragment,U),R=!1},d(U){U&&u(t),re(k),re(h),T&&T.d(),W=!1,Fe(K)}}}function Se(e){let t,s,n,o,r,f,k,p,_,x,d,h,j,I,B,C,V,P,J,S,A,H=e[0],i=[];for(let l=0;l<H.length;l+=1)i[l]=$e(be(e,H,l));const G=l=>X(i[l],1,1,()=>{i[l]=null}),q=e[4].default,D=Me(q,e,e[3],null);return{c(){t=y(),s=m("div"),n=m("table"),o=m("thead"),r=m("tr"),f=m("th"),k=F("Name / id"),p=y(),_=m("th"),x=F("Priority"),d=y(),h=m("th"),j=F("URL"),I=y(),B=m("th"),C=F("Runs"),V=y(),P=m("th"),J=y();for(let l=0;l<i.length;l+=1)i[l].c();S=y(),D&&D.c(),this.h()},l(l){Re("svelte-16df4tm",document.head).forEach(u),t=w(l),s=v(l,"DIV",{class:!0});var c=g(s);n=v(c,"TABLE",{class:!0});var N=g(n);o=v(N,"THEAD",{class:!0});var O=g(o);r=v(O,"TR",{});var M=g(r);f=v(M,"TH",{class:!0});var R=g(f);k=L(R,"Name / id"),R.forEach(u),p=w(M),_=v(M,"TH",{class:!0});var W=g(_);x=L(W,"Priority"),W.forEach(u),d=w(M),h=v(M,"TH",{class:!0});var K=g(h);j=L(K,"URL"),K.forEach(u),I=w(M),B=v(M,"TH",{class:!0});var Z=g(B);C=L(Z,"Runs"),Z.forEach(u),V=w(M),P=v(M,"TH",{class:!0}),g(P).forEach(u),M.forEach(u),O.forEach(u),J=w(N);for(let T=0;T<i.length;T+=1)i[T].l(N);N.forEach(u),S=w(c),D&&D.l(c),c.forEach(u),this.h()},h(){document.title="Background Jobs | platformOS",b(f,"class","id svelte-1i30xx0"),b(_,"class","svelte-1i30xx0"),b(h,"class","svelte-1i30xx0"),b(B,"class","svelte-1i30xx0"),b(P,"class","svelte-1i30xx0"),b(o,"class","svelte-1i30xx0"),b(n,"class","svelte-1i30xx0"),b(s,"class","container svelte-1i30xx0")},m(l,E){Y(l,t,E),Y(l,s,E),a(s,n),a(n,o),a(o,r),a(r,f),a(f,k),a(r,p),a(r,_),a(_,x),a(r,d),a(r,h),a(h,j),a(r,I),a(r,B),a(B,C),a(r,V),a(r,P),a(n,J);for(let c=0;c<i.length;c+=1)i[c]&&i[c].m(n,null);a(s,S),D&&D.m(s,null),A=!0},p(l,[E]){if(E&7){H=l[0];let c;for(c=0;c<H.length;c+=1){const N=be(l,H,c);i[c]?(i[c].p(N,E),Q(i[c],1)):(i[c]=$e(N),i[c].c(),Q(i[c],1),i[c].m(n,null))}for(Le(),c=H.length;c<i.length;c+=1)G(c);Ue()}D&&D.p&&(!A||E&8)&&Be(D,q,l,l[3],A?Ae(q,l[3],E,null):je(l[3]),null)},i(l){if(!A){for(let E=0;E<H.length;E+=1)Q(i[E]);Q(D,l),A=!0}},o(l){i=i.filter(Boolean);for(let E=0;E<i.length;E+=1)X(i[E]);X(D,l),A=!1},d(l){l&&u(t),l&&u(s),He(i,l),D&&D.d(l)}}}function ze(e,t,s){let{$$slots:n={},$$scope:o}=t,r=[],f={id:null},k;const p=async()=>{clearInterval(k),s(0,r=await ye.get()),k=setInterval(()=>{r.forEach(d=>{d.run_at_parsed=oe(new Date(d.run_at))})},1e3)};Ne(()=>{p()});const _=d=>s(1,f.id=d.id,f),x=()=>s(1,f.id=null,f);return e.$$set=d=>{"$$scope"in d&&s(3,o=d.$$scope)},[r,f,p,o,n,_,x]}class Qe extends ke{constructor(t){super(),Te(this,t,ze,Se,De,{})}}export{Qe as component};
