import{s as we,f as _,a as N,l as V,g as m,h as b,c as j,m as J,d as f,j as u,i as W,u as l,x as ee,H as Ve,p as Te,D as Qe,I as We,r as fe,J as De,B as Xe,K as Be,L as Je,n as me,E as Ye,F as Ze,G as xe,M as et,y as ze,v as tt,N as at,w as Fe,O as Re,P as nt}from"../chunks/scheduler.e2aa1391.js";import{S as Ie,i as Se,b as he,d as pe,m as ve,a as H,t as Q,e as ge,c as Ge,g as Ke}from"../chunks/index.12b5c620.js";import{e as Ue}from"../chunks/each.c0161bb5.js";import"../chunks/singletons.886a03ad.js";import{p as st}from"../chunks/stores.a142ec2e.js";import{b as Le}from"../chunks/backgroundJob.c756ecec.js";import{I as Ne}from"../chunks/Icon.a5fa4953.js";import{s as ke}from"../chunks/state.f2691bd0.js";const de=e=>{const a=e instanceof Date?e:new Date(e),t=new Intl.RelativeTimeFormat("en"),n={years:3600*24*365,months:3600*24*30,weeks:3600*24*7,days:3600*24,hours:3600,minutes:60,seconds:1},s=(a.getTime()-Date.now())/1e3;for(let r in n)if(n[r]<Math.abs(s)){const d=s/n[r];return t.format(Math.round(d),r)}};function lt(e){let a,t,n,s,r,d,h,o,E;return r=new Ne({props:{icon:"refresh",size:"22"}}),{c(){a=_("form"),t=_("input"),n=N(),s=_("button"),he(r.$$.fragment),d=V(`\r
    Retry`),this.h()},l(c){a=m(c,"FORM",{});var i=b(a);t=m(i,"INPUT",{type:!0,name:!0}),n=j(i),s=m(i,"BUTTON",{class:!0});var $=b(s);pe(r.$$.fragment,$),d=J($,`\r
    Retry`),$.forEach(f),i.forEach(f),this.h()},h(){u(t,"type","hidden"),u(t,"name","id"),t.value=e[0],u(s,"class","danger")},m(c,i){W(c,a,i),l(a,t),l(a,n),l(a,s),ve(r,s,null),l(s,d),e[3](a),h=!0,o||(E=ee(a,"submit",e[2]),o=!0)},p(c,[i]){(!h||i&1)&&(t.value=c[0])},i(c){h||(H(r.$$.fragment,c),h=!0)},o(c){Q(r.$$.fragment,c),h=!1},d(c){c&&f(a),ge(r),e[3](null),o=!1,E()}}}function rt(e,a,t){let{id:n}=a,s;const r=Ve(),d=async o=>{o.preventDefault();const E=await Le.retry({properties:new FormData(s)});E.errors?ke.notification.create("error",`Background job ${E.admin_background_job_retry.id} could not be run again`):(r("itemsChanged"),ke.notification.create("success",`Background job ${E.admin_background_job_retry.id} planned to run again`))};function h(o){Te[o?"unshift":"push"](()=>{s=o,t(1,s)})}return e.$$set=o=>{"id"in o&&t(0,n=o.id)},[n,s,d,h]}class ot extends Ie{constructor(a){super(),Se(this,a,rt,lt,we,{id:0})}}function it(e){let a,t,n,s,r,d,h,o,E,c;return d=new Ne({props:{icon:"x",size:"22"}}),{c(){a=_("form"),t=_("input"),n=N(),s=_("button"),r=_("i"),he(d.$$.fragment),h=V(`\r
    Delete background job`),this.h()},l(i){a=m(i,"FORM",{});var $=b(a);t=m($,"INPUT",{type:!0,name:!0}),n=j($),s=m($,"BUTTON",{class:!0});var C=b(s);r=m(C,"I",{class:!0});var S=b(r);pe(d.$$.fragment,S),S.forEach(f),h=J(C,`\r
    Delete background job`),C.forEach(f),$.forEach(f),this.h()},h(){u(t,"type","hidden"),u(t,"name","id"),t.value=e[0],u(r,"class","svelte-ooaugn"),u(s,"class","danger")},m(i,$){W(i,a,$),l(a,t),l(a,n),l(a,s),l(s,r),ve(d,r,null),l(s,h),e[3](a),o=!0,E||(c=ee(a,"submit",e[2]),E=!0)},p(i,[$]){(!o||$&1)&&(t.value=i[0])},i(i){o||(H(d.$$.fragment,i),o=!0)},o(i){Q(d.$$.fragment,i),o=!1},d(i){i&&f(a),ge(d),e[3](null),E=!1,c()}}}function ut(e,a,t){let{id:n}=a,s;const r=Ve(),d=async o=>{if(o.preventDefault(),confirm("Are you sure you want to delete this background job?")){const E=await Le.delete({properties:new FormData(s)});E.errors?ke.notification.create("error",`Background job ${E.admin_background_job_delete.id} could not be deleted`):(r("itemsChanged"),ke.notification.create("success",`Background job ${E.admin_background_job_delete.id} deleted`))}};function h(o){Te[o?"unshift":"push"](()=>{s=o,t(1,s)})}return e.$$set=o=>{"id"in o&&t(0,n=o.id)},[n,s,d,h]}class ct extends Ie{constructor(a){super(),Se(this,a,ut,it,we,{id:0})}}function Me(e,a,t){const n=e.slice();return n[15]=a[t],n}function ft(e){let a;return{c(){a=V("Runs")},l(t){a=J(t,"Runs")},m(t,n){W(t,a,n)},d(t){t&&f(a)}}}function dt(e){let a;return{c(){a=V("Failed")},l(t){a=J(t,"Failed")},m(t,n){W(t,a,n)},d(t){t&&f(a)}}}function qe(e){let a,t,n;return t=new ot({props:{id:e[15].id}}),t.$on("itemsChanged",e[5]),{c(){a=_("li"),he(t.$$.fragment),this.h()},l(s){a=m(s,"LI",{class:!0});var r=b(a);pe(t.$$.fragment,r),r.forEach(f),this.h()},h(){u(a,"class","svelte-hyom4y")},m(s,r){W(s,a,r),ve(t,a,null),n=!0},p(s,r){const d={};r&2&&(d.id=s[15].id),t.$set(d)},i(s){n||(H(t.$$.fragment,s),n=!0)},o(s){Q(t.$$.fragment,s),n=!1},d(s){s&&f(a),ge(t)}}}function _t(e){let a=(e[15].run_at_parsed||de(new Date(e[15].run_at)))+"",t;return{c(){t=V(a)},l(n){t=J(n,a)},m(n,s){W(n,t,s)},p(n,s){s&2&&a!==(a=(n[15].run_at_parsed||de(new Date(n[15].run_at)))+"")&&me(t,a)},d(n){n&&f(t)}}}function mt(e){let a=(e[15].dead_at_parsed||de(new Date(e[15].dead_at))||"")+"",t;return{c(){t=V(a)},l(n){t=J(n,a)},m(n,s){W(n,t,s)},p(n,s){s&2&&a!==(a=(n[15].dead_at_parsed||de(new Date(n[15].dead_at))||"")+"")&&me(t,a)},d(n){n&&f(t)}}}function He(e){let a,t,n,s,r,d="More options",h,o,E,c,i,$,C,S,X,T,g=(e[15].source_name||e[15].id)+"",P,M,re,z,F=e[15].queue+"",te,ae,O,ne,q,R,oe;o=new Ne({props:{icon:"navigationMenuVertical",size:"16"}});function L(){return e[10](e[15])}let D=e[15].dead_at&&qe(e);S=new ct({props:{id:e[15].id}}),S.$on("itemsChanged",e[5]);function ie(I,v){return I[0].type==="DEAD"?mt:_t}let G=ie(e),A=G(e);return{c(){a=_("tr"),t=_("td"),n=_("div"),s=_("button"),r=_("span"),r.textContent=d,h=N(),he(o.$$.fragment),E=N(),c=_("menu"),i=_("ul"),D&&D.c(),$=N(),C=_("li"),he(S.$$.fragment),X=N(),T=_("a"),P=V(g),re=N(),z=_("td"),te=V(F),ae=N(),O=_("td"),A.c(),ne=N(),this.h()},l(I){a=m(I,"TR",{class:!0});var v=b(a);t=m(v,"TD",{class:!0});var Y=b(t);n=m(Y,"DIV",{class:!0});var Z=b(n);s=m(Z,"BUTTON",{class:!0});var se=b(s);r=m(se,"SPAN",{class:!0,"data-svelte-h":!0}),fe(r)!=="svelte-1agpmtc"&&(r.textContent=d),h=j(se),pe(o.$$.fragment,se),se.forEach(f),E=j(Z),c=m(Z,"MENU",{class:!0});var le=b(c);i=m(le,"UL",{});var B=b(i);D&&D.l(B),$=j(B),C=m(B,"LI",{class:!0});var K=b(C);pe(S.$$.fragment,K),K.forEach(f),B.forEach(f),le.forEach(f),X=j(Z),T=m(Z,"A",{href:!0,class:!0});var y=b(T);P=J(y,g),y.forEach(f),Z.forEach(f),Y.forEach(f),re=j(v),z=m(v,"TD",{class:!0});var ye=b(z);te=J(ye,F),ye.forEach(f),ae=j(v),O=m(v,"TD",{class:!0});var ue=b(O);A.l(ue),ue.forEach(f),ne=j(v),v.forEach(f),this.h()},h(){u(r,"class","label"),u(s,"class","button compact more svelte-hyom4y"),u(C,"class","svelte-hyom4y"),u(c,"class","content-context svelte-hyom4y"),Fe(c,"active",e[2].id===e[15].id),u(T,"href",M="/backgroundJobs/"+e[0].type.toLowerCase()+"/"+e[15].id+"?"+e[4].url.searchParams.toString()),u(T,"class","svelte-hyom4y"),u(n,"class","svelte-hyom4y"),u(t,"class","id svelte-hyom4y"),u(z,"class","svelte-hyom4y"),u(O,"class","svelte-hyom4y"),u(a,"class","svelte-hyom4y")},m(I,v){W(I,a,v),l(a,t),l(t,n),l(n,s),l(s,r),l(s,h),ve(o,s,null),l(n,E),l(n,c),l(c,i),D&&D.m(i,null),l(i,$),l(i,C),ve(S,C,null),l(n,X),l(n,T),l(T,P),l(a,re),l(a,z),l(z,te),l(a,ae),l(a,O),A.m(O,null),l(a,ne),q=!0,R||(oe=[ee(s,"click",L),ee(t,"mouseleave",e[11])],R=!0)},p(I,v){e=I,e[15].dead_at?D?(D.p(e,v),v&2&&H(D,1)):(D=qe(e),D.c(),H(D,1),D.m(i,$)):D&&(Ke(),Q(D,1,1,()=>{D=null}),Ge());const Y={};v&2&&(Y.id=e[15].id),S.$set(Y),(!q||v&6)&&Fe(c,"active",e[2].id===e[15].id),(!q||v&2)&&g!==(g=(e[15].source_name||e[15].id)+"")&&me(P,g),(!q||v&19&&M!==(M="/backgroundJobs/"+e[0].type.toLowerCase()+"/"+e[15].id+"?"+e[4].url.searchParams.toString()))&&u(T,"href",M),(!q||v&2)&&F!==(F=e[15].queue+"")&&me(te,F),G===(G=ie(e))&&A?A.p(e,v):(A.d(1),A=G(e),A&&(A.c(),A.m(O,null)))},i(I){q||(H(o.$$.fragment,I),H(D),H(S.$$.fragment,I),q=!0)},o(I){Q(o.$$.fragment,I),Q(D),Q(S.$$.fragment,I),q=!1},d(I){I&&f(a),ge(o),D&&D.d(),ge(S),A.d(),R=!1,ze(oe)}}}function ht(e){let a,t,n,s,r,d,h,o="Type:",E,c,i,$="Scheduled",C,S="Failed",X,T,g,P,M,re="Name / id",z,F,te="Priority",ae,O,ne,q,R,oe,L,D,ie,G=(e[1].total_pages||"")+"",A,I,v,Y,Z;function se(p,w){return p[0].type==="DEAD"?dt:ft}let le=se(e),B=le(e),K=Ue(e[1].results),y=[];for(let p=0;p<K.length;p+=1)y[p]=He(Me(e,K,p));const ye=p=>Q(y[p],1,1,()=>{y[p]=null}),ue=e[7].default,U=Qe(ue,e,e[6],null);return{c(){a=N(),t=_("div"),n=_("div"),s=_("nav"),r=_("form"),d=_("fieldset"),h=_("label"),h.textContent=o,E=N(),c=_("select"),i=_("option"),i.textContent=$,C=_("option"),C.textContent=S,X=N(),T=_("table"),g=_("thead"),P=_("tr"),M=_("th"),M.textContent=re,z=N(),F=_("th"),F.textContent=te,ae=N(),O=_("th"),B.c(),ne=N();for(let p=0;p<y.length;p+=1)y[p].c();q=N(),R=_("nav"),oe=V(`Page:\r
      `),L=_("input"),ie=V(`\r
      of `),A=V(G),I=N(),U&&U.c(),this.h()},l(p){We("svelte-16df4tm",document.head).forEach(f),a=j(p),t=m(p,"DIV",{class:!0});var k=b(t);n=m(k,"DIV",{class:!0});var x=b(n);s=m(x,"NAV",{class:!0});var je=b(s);r=m(je,"FORM",{id:!0,class:!0});var Ae=b(r);d=m(Ae,"FIELDSET",{class:!0});var be=b(d);h=m(be,"LABEL",{for:!0,"data-svelte-h":!0}),fe(h)!=="svelte-iw296f"&&(h.textContent=o),E=j(be),c=m(be,"SELECT",{name:!0,id:!0});var $e=b(c);i=m($e,"OPTION",{"data-svelte-h":!0}),fe(i)!=="svelte-1nu502o"&&(i.textContent=$),C=m($e,"OPTION",{"data-svelte-h":!0}),fe(C)!=="svelte-105yz3n"&&(C.textContent=S),$e.forEach(f),be.forEach(f),Ae.forEach(f),je.forEach(f),X=j(x),T=m(x,"TABLE",{class:!0});var Ee=b(T);g=m(Ee,"THEAD",{class:!0});var Oe=b(g);P=m(Oe,"TR",{});var ce=b(P);M=m(ce,"TH",{class:!0,"data-svelte-h":!0}),fe(M)!=="svelte-17wqap5"&&(M.textContent=re),z=j(ce),F=m(ce,"TH",{class:!0,"data-svelte-h":!0}),fe(F)!=="svelte-wgplya"&&(F.textContent=te),ae=j(ce),O=m(ce,"TH",{class:!0});var Pe=b(O);B.l(Pe),Pe.forEach(f),ce.forEach(f),Oe.forEach(f),ne=j(Ee);for(let Ce=0;Ce<y.length;Ce+=1)y[Ce].l(Ee);Ee.forEach(f),q=j(x),R=m(x,"NAV",{class:!0});var _e=b(R);oe=J(_e,`Page:\r
      `),L=m(_e,"INPUT",{type:!0,name:!0,min:!0,max:!0,step:!0,form:!0}),ie=J(_e,`\r
      of `),A=J(_e,G),_e.forEach(f),x.forEach(f),I=j(k),U&&U.l(k),k.forEach(f),this.h()},h(){document.title="Background Jobs | platformOS",u(h,"for","filter-type"),i.__value="SCHEDULED",De(i,i.__value),C.__value="DEAD",De(C,C.__value),u(c,"name","type"),u(c,"id","filter-type"),e[0].type===void 0&&Xe(()=>e[8].call(c)),u(d,"class","svelte-hyom4y"),u(r,"id","filters"),u(r,"class","svelte-hyom4y"),u(s,"class","filters svelte-hyom4y"),u(M,"class","id svelte-hyom4y"),u(F,"class","svelte-hyom4y"),u(O,"class","svelte-hyom4y"),u(g,"class","svelte-hyom4y"),u(T,"class","svelte-hyom4y"),u(L,"type","number"),u(L,"name","page"),u(L,"min","1"),u(L,"max",D=e[1].total_pages||100),u(L,"step","1"),u(L,"form","filters"),u(R,"class","pagination svelte-hyom4y"),u(n,"class","svelte-hyom4y"),u(t,"class","container svelte-hyom4y")},m(p,w){W(p,a,w),W(p,t,w),l(t,n),l(n,s),l(s,r),l(r,d),l(d,h),l(d,E),l(d,c),l(c,i),l(c,C),Be(c,e[0].type,!0),e[9](r),l(n,X),l(n,T),l(T,g),l(g,P),l(P,M),l(P,z),l(P,F),l(P,ae),l(P,O),B.m(O,null),l(T,ne);for(let k=0;k<y.length;k+=1)y[k]&&y[k].m(T,null);l(n,q),l(n,R),l(R,oe),l(R,L),De(L,e[0].page),l(R,ie),l(R,A),l(t,I),U&&U.m(t,null),v=!0,Y||(Z=[ee(c,"change",e[8]),ee(c,"change",function(){Re(e[3].requestSubmit())&&e[3].requestSubmit().apply(this,arguments)}),ee(L,"input",e[12]),ee(L,"change",function(){Re(e[3].requestSubmit())&&e[3].requestSubmit().apply(this,arguments)})],Y=!0)},p(p,[w]){if(e=p,w&1&&Be(c,e[0].type),le!==(le=se(e))&&(B.d(1),B=le(e),B&&(B.c(),B.m(O,null))),w&55){K=Ue(e[1].results);let k;for(k=0;k<K.length;k+=1){const x=Me(e,K,k);y[k]?(y[k].p(x,w),H(y[k],1)):(y[k]=He(x),y[k].c(),H(y[k],1),y[k].m(T,null))}for(Ke(),k=K.length;k<y.length;k+=1)ye(k);Ge()}(!v||w&2&&D!==(D=e[1].total_pages||100))&&u(L,"max",D),w&1&&Je(L.value)!==e[0].page&&De(L,e[0].page),(!v||w&2)&&G!==(G=(e[1].total_pages||"")+"")&&me(A,G),U&&U.p&&(!v||w&64)&&Ye(U,ue,e,e[6],v?xe(ue,e[6],w,null):Ze(e[6]),null)},i(p){if(!v){for(let w=0;w<K.length;w+=1)H(y[w]);H(U,p),v=!0}},o(p){y=y.filter(Boolean);for(let w=0;w<y.length;w+=1)Q(y[w]);Q(U,p),v=!1},d(p){p&&(f(a),f(t)),e[9](null),B.d(),et(y,p),U&&U.d(p),Y=!1,ze(Z)}}}function pt(e,a,t){let n;tt(e,st,g=>t(4,n=g));let{$$slots:s={},$$scope:r}=a,d={results:[]},h={id:null},o={page:1,type:"SCHEDULED",...Object.fromEntries(n.url.searchParams)},E,c;const i=async()=>{clearInterval(c),t(1,d=await Le.get(o)),c=setInterval(()=>{d.results.forEach(g=>{o.type==="DEAD"?g.dead_at_parsed=de(new Date(g.dead_at)):g.run_at_parsed=de(new Date(g.run_at))})},1e3)};at(()=>{clearInterval(c)});function $(){o.type=nt(this),t(0,o)}function C(g){Te[g?"unshift":"push"](()=>{E=g,t(3,E)})}const S=g=>t(2,h.id=g.id,h),X=()=>t(2,h.id=null,h);function T(){o.page=Je(this.value),t(0,o)}return e.$$set=g=>{"$$scope"in g&&t(6,r=g.$$scope)},e.$$.update=()=>{e.$$.dirty&1&&o&&i()},[o,d,h,E,n,i,r,s,$,C,S,X,T]}class Ct extends Ie{constructor(a){super(),Se(this,a,pt,ht,we,{})}}export{Ct as component};
