import{S as Ue,i as je,s as Ae,d as u,E as me,o as V,p as B,b as Q,c as l,I as pe,J as he,z as c,e as d,f as y,h as L,L as ge,g as W,j as f,k as N,M as ve,t as X,W as Xe,C as Le,D as at,ac as He,m as nt,O as st,x as Ye,ae as Je,H as Ze,G as lt,a as De,u as rt,q as ot,r as it,F as Pe,X as ut,v as dt,K as ae,l as Ve,af as ft,R as xe,Q as ze,ag as ct}from"../chunks/n7YEDvJi.js";import{e as Ke}from"../chunks/DMhVG_ro.js";import"../chunks/IHki7fMi.js";import"../chunks/BkTZdoZE.js";import{p as _t}from"../chunks/C6Nbyvij.js";import{b as Me}from"../chunks/CIy9Z9Qf.js";import{s as Ce}from"../chunks/Bp_ajb_u.js";import{I as Oe}from"../chunks/DHO4ENnJ.js";import{N as mt}from"../chunks/CYamOUSl.js";const be=e=>{const t=e instanceof Date?e:new Date(e),a=new Intl.RelativeTimeFormat("en"),n={years:3600*24*365,months:3600*24*30,weeks:3600*24*7,days:3600*24,hours:3600,minutes:60,seconds:1},s=(t.getTime()-Date.now())/1e3;for(let i in n)if(n[i]<Math.abs(s)){const _=s/n[i];return a.format(Math.round(_),i)}};function pt(e){let t,a,n,s,i,_,v,o,p;return i=new Oe({props:{icon:"refresh",size:"22"}}),{c(){t=f("form"),a=f("input"),n=N(),s=f("button"),ve(i.$$.fragment),_=X(`
    Retry`),this.h()},l(h){t=d(h,"FORM",{});var r=y(t);a=d(r,"INPUT",{type:!0,name:!0}),n=L(r),s=d(r,"BUTTON",{class:!0});var b=y(s);ge(i.$$.fragment,b),_=W(b,`
    Retry`),b.forEach(u),r.forEach(u),this.h()},h(){c(a,"type","hidden"),c(a,"name","id"),a.value=e[0],c(s,"class","danger")},m(h,r){Q(h,t,r),l(t,a),l(t,n),l(t,s),pe(i,s,null),l(s,_),e[3](t),v=!0,o||(p=he(t,"submit",e[2]),o=!0)},p(h,[r]){(!v||r&1)&&(a.value=h[0])},i(h){v||(B(i.$$.fragment,h),v=!0)},o(h){V(i.$$.fragment,h),v=!1},d(h){h&&u(t),me(i),e[3](null),o=!1,p()}}}function ht(e,t,a){let{id:n}=t,s;const i=Xe(),_=async o=>{o.preventDefault();const p=await Me.retry({properties:new FormData(s)});p.errors?Ce.notification.create("error",`Background job ${p.admin_background_job_retry.id} could not be run again`):(i("itemsChanged"),Ce.notification.create("success",`Background job ${p.admin_background_job_retry.id} planned to run again`))};function v(o){Le[o?"unshift":"push"](()=>{s=o,a(1,s)})}return e.$$set=o=>{"id"in o&&a(0,n=o.id)},[n,s,_,v]}class gt extends Ue{constructor(t){super(),je(this,t,ht,pt,Ae,{id:0})}}function vt(e){let t,a,n,s,i,_,v,o,p,h;return _=new Oe({props:{icon:"x",size:"22"}}),{c(){t=f("form"),a=f("input"),n=N(),s=f("button"),i=f("i"),ve(_.$$.fragment),v=X(`
    Delete background job`),this.h()},l(r){t=d(r,"FORM",{});var b=y(t);a=d(b,"INPUT",{type:!0,name:!0}),n=L(b),s=d(b,"BUTTON",{class:!0});var P=y(s);i=d(P,"I",{class:!0});var k=y(i);ge(_.$$.fragment,k),k.forEach(u),v=W(P,`
    Delete background job`),P.forEach(u),b.forEach(u),this.h()},h(){c(a,"type","hidden"),c(a,"name","id"),a.value=e[0],c(i,"class","svelte-ooaugn"),c(s,"class","danger")},m(r,b){Q(r,t,b),l(t,a),l(t,n),l(t,s),l(s,i),pe(_,i,null),l(s,v),e[3](t),o=!0,p||(h=he(t,"submit",e[2]),p=!0)},p(r,[b]){(!o||b&1)&&(a.value=r[0])},i(r){o||(B(_.$$.fragment,r),o=!0)},o(r){V(_.$$.fragment,r),o=!1},d(r){r&&u(t),me(_),e[3](null),p=!1,h()}}}function bt(e,t,a){let{id:n}=t,s;const i=Xe(),_=async o=>{if(o.preventDefault(),confirm("Are you sure you want to delete this background job?")){const p=await Me.delete({properties:new FormData(s)});p.errors?Ce.notification.create("error",`Background job ${p.admin_background_job_delete.id} could not be deleted`):(i("itemsChanged"),Ce.notification.create("success",`Background job ${p.admin_background_job_delete.id} deleted`))}};function v(o){Le[o?"unshift":"push"](()=>{s=o,a(1,s)})}return e.$$set=o=>{"id"in o&&a(0,n=o.id)},[n,s,_,v]}class Et extends Ue{constructor(t){super(),je(this,t,bt,vt,Ae,{id:0})}}function Ge(e,t,a){const n=e.slice();return n[16]=t[a],n}function yt(e){let t;return{c(){t=X("Runs")},l(a){t=W(a,"Runs")},m(a,n){Q(a,t,n)},d(a){a&&u(t)}}}function $t(e){let t;return{c(){t=X("Failed")},l(a){t=W(a,"Failed")},m(a,n){Q(a,t,n)},d(a){a&&u(t)}}}function Qe(e){let t,a,n;return a=new gt({props:{id:e[16].id}}),a.$on("itemsChanged",e[6]),{c(){t=f("li"),ve(a.$$.fragment),this.h()},l(s){t=d(s,"LI",{class:!0});var i=y(t);ge(a.$$.fragment,i),i.forEach(u),this.h()},h(){c(t,"class","svelte-1m1ug4d")},m(s,i){Q(s,t,i),pe(a,t,null),n=!0},p(s,i){const _={};i&2&&(_.id=s[16].id),a.$set(_)},i(s){n||(B(a.$$.fragment,s),n=!0)},o(s){V(a.$$.fragment,s),n=!1},d(s){s&&u(t),me(a)}}}function kt(e){let t=(e[16].run_at_parsed||be(new Date(e[16].run_at)))+"",a;return{c(){a=X(t)},l(n){a=W(n,t)},m(n,s){Q(n,a,s)},p(n,s){s&2&&t!==(t=(n[16].run_at_parsed||be(new Date(n[16].run_at)))+"")&&De(a,t)},d(n){n&&u(a)}}}function Dt(e){let t=(e[16].dead_at_parsed||be(new Date(e[16].dead_at))||"")+"",a;return{c(){a=X(t)},l(n){a=W(n,t)},m(n,s){Q(n,a,s)},p(n,s){s&2&&t!==(t=(n[16].dead_at_parsed||be(new Date(n[16].dead_at))||"")+"")&&De(a,t)},d(n){n&&u(a)}}}function We(e){let t,a,n,s,i,_="More options",v,o,p,h,r,b,P,k,te,w,z=(e[16].source_name||e[16].id)+"",E,A,K,R,M=e[16].queue+"",ne,se,U,ie,F,J,ue;o=new Oe({props:{icon:"navigationMenuVertical",size:"16"}});function Ee(){return e[11](e[16])}let g=e[16].dead_at&&Qe(e);k=new Et({props:{id:e[16].id}}),k.$on("itemsChanged",e[6]);function G($,C){return $[0].type==="DEAD"?Dt:kt}let le=G(e),j=le(e);return{c(){t=f("tr"),a=f("td"),n=f("div"),s=f("button"),i=f("span"),i.textContent=_,v=N(),ve(o.$$.fragment),p=N(),h=f("menu"),r=f("ul"),g&&g.c(),b=N(),P=f("li"),ve(k.$$.fragment),te=N(),w=f("a"),E=X(z),K=N(),R=f("td"),ne=X(M),se=N(),U=f("td"),j.c(),ie=N(),this.h()},l($){t=d($,"TR",{class:!0});var C=y(t);a=d(C,"TD",{class:!0});var Y=y(a);n=d(Y,"DIV",{class:!0});var H=y(n);s=d(H,"BUTTON",{class:!0});var Z=y(s);i=d(Z,"SPAN",{class:!0,"data-svelte-h":!0}),ae(i)!=="svelte-1agpmtc"&&(i.textContent=_),v=L(Z),ge(o.$$.fragment,Z),Z.forEach(u),p=L(H),h=d(H,"MENU",{class:!0});var de=y(h);r=d(de,"UL",{});var O=y(r);g&&g.l(O),b=L(O),P=d(O,"LI",{class:!0});var fe=y(P);ge(k.$$.fragment,fe),fe.forEach(u),O.forEach(u),de.forEach(u),te=L(H),w=d(H,"A",{href:!0,class:!0});var ye=y(w);E=W(ye,z),ye.forEach(u),H.forEach(u),Y.forEach(u),K=L(C),R=d(C,"TD",{class:!0});var $e=y(R);ne=W($e,M),$e.forEach(u),se=L(C),U=d(C,"TD",{class:!0});var re=y(U);j.l(re),re.forEach(u),ie=L(C),C.forEach(u),this.h()},h(){c(i,"class","label"),c(s,"class","button compact more svelte-1m1ug4d"),c(P,"class","svelte-1m1ug4d"),c(h,"class","content-context svelte-1m1ug4d"),ze(h,"active",e[2].id===e[16].id),c(w,"href",A="/backgroundJobs/"+e[0].type.toLowerCase()+"/"+e[16].id+"?"+e[4].url.searchParams.toString()),c(w,"class","svelte-1m1ug4d"),c(n,"class","svelte-1m1ug4d"),c(a,"class","id svelte-1m1ug4d"),c(R,"class","svelte-1m1ug4d"),c(U,"class","svelte-1m1ug4d"),c(t,"class","svelte-1m1ug4d")},m($,C){Q($,t,C),l(t,a),l(a,n),l(n,s),l(s,i),l(s,v),pe(o,s,null),l(n,p),l(n,h),l(h,r),g&&g.m(r,null),l(r,b),l(r,P),pe(k,P,null),l(n,te),l(n,w),l(w,E),l(t,K),l(t,R),l(R,ne),l(t,se),l(t,U),j.m(U,null),l(t,ie),F=!0,J||(ue=[he(s,"click",Ee),he(a,"mouseleave",e[12])],J=!0)},p($,C){e=$,e[16].dead_at?g?(g.p(e,C),C&2&&B(g,1)):(g=Qe(e),g.c(),B(g,1),g.m(r,b)):g&&(xe(),V(g,1,1,()=>{g=null}),Ze());const Y={};C&2&&(Y.id=e[16].id),k.$set(Y),(!F||C&6)&&ze(h,"active",e[2].id===e[16].id),(!F||C&2)&&z!==(z=(e[16].source_name||e[16].id)+"")&&De(E,z),(!F||C&19&&A!==(A="/backgroundJobs/"+e[0].type.toLowerCase()+"/"+e[16].id+"?"+e[4].url.searchParams.toString()))&&c(w,"href",A),(!F||C&2)&&M!==(M=e[16].queue+"")&&De(ne,M),le===(le=G(e))&&j?j.p(e,C):(j.d(1),j=le(e),j&&(j.c(),j.m(U,null)))},i($){F||(B(o.$$.fragment,$),B(g),B(k.$$.fragment,$),F=!0)},o($){V(o.$$.fragment,$),V(g),V(k.$$.fragment,$),F=!1},d($){$&&u(t),me(o),g&&g.d(),me(k),j.d(),J=!1,Ye(ue)}}}function Ct(e){var qe;let t,a,n,s,i,_,v,o,p="Type:",h,r,b,P="Scheduled",k,te="Failed",w,z="Running",E,A,K,R,M,ne="Name / id",se,U,ie="Priority",F,J,ue,Ee,g,G,le="Page:",j,$,C,Y,H=(e[1].total_pages||1)+"",Z,de,O,fe,ye;document.title=t="Jobs"+((qe=e[5].online)!=null&&qe.MPKIT_URL?": "+e[5].online.MPKIT_URL.replace("https://",""):"");function $e(m,T){return m[0].type==="DEAD"?$t:yt}let re=$e(e),x=re(e),oe=Ke(e[1].results),D=[];for(let m=0;m<oe.length;m+=1)D[m]=We(Ge(e,oe,m));const et=m=>V(D[m],1,1,()=>{D[m]=null});function tt(m){e[13](m)}let Se={form:"filters",name:"page",min:1,max:e[1].total_pages,step:1,decreaseLabel:"Previous page",increaseLabel:"Next page",style:"navigation"};e[0].page!==void 0&&(Se.value=e[0].page),$=new mt({props:Se}),Le.push(()=>at($,"value",tt)),$.$on("input",function(){He(e[3].requestSubmit())&&e[3].requestSubmit().apply(this,arguments)});const Ne=e[8].default,S=nt(Ne,e,e[7],null);return{c(){a=N(),n=f("div"),s=f("div"),i=f("nav"),_=f("form"),v=f("fieldset"),o=f("label"),o.textContent=p,h=N(),r=f("select"),b=f("option"),b.textContent=P,k=f("option"),k.textContent=te,w=f("option"),w.textContent=z,E=N(),A=f("table"),K=f("thead"),R=f("tr"),M=f("th"),M.textContent=ne,se=N(),U=f("th"),U.textContent=ie,F=N(),J=f("th"),x.c(),ue=N();for(let m=0;m<D.length;m+=1)D[m].c();Ee=N(),g=f("nav"),G=f("label"),G.textContent=le,j=N(),ve($.$$.fragment),Y=X(`
      of `),Z=X(H),de=N(),S&&S.c(),this.h()},l(m){dt("svelte-qj8tye",document.head).forEach(u),a=L(m),n=d(m,"DIV",{class:!0});var q=y(n);s=d(q,"DIV",{class:!0});var ee=y(s);i=d(ee,"NAV",{class:!0});var I=y(i);_=d(I,"FORM",{id:!0,class:!0});var ke=y(_);v=d(ke,"FIELDSET",{class:!0});var Te=y(v);o=d(Te,"LABEL",{for:!0,"data-svelte-h":!0}),ae(o)!=="svelte-iw296f"&&(o.textContent=p),h=L(Te),r=d(Te,"SELECT",{name:!0,id:!0});var we=y(r);b=d(we,"OPTION",{"data-svelte-h":!0}),ae(b)!=="svelte-1nu502o"&&(b.textContent=P),k=d(we,"OPTION",{"data-svelte-h":!0}),ae(k)!=="svelte-105yz3n"&&(k.textContent=te),w=d(we,"OPTION",{"data-svelte-h":!0}),ae(w)!=="svelte-o8mv68"&&(w.textContent=z),we.forEach(u),Te.forEach(u),ke.forEach(u),I.forEach(u),E=L(ee),A=d(ee,"TABLE",{class:!0});var Ie=y(A);K=d(Ie,"THEAD",{class:!0});var Be=y(K);R=d(Be,"TR",{});var ce=y(R);M=d(ce,"TH",{class:!0,"data-svelte-h":!0}),ae(M)!=="svelte-17wqap5"&&(M.textContent=ne),se=L(ce),U=d(ce,"TH",{class:!0,"data-svelte-h":!0}),ae(U)!=="svelte-wgplya"&&(U.textContent=ie),F=L(ce),J=d(ce,"TH",{class:!0});var Fe=y(J);x.l(Fe),Fe.forEach(u),ce.forEach(u),Be.forEach(u),ue=L(Ie);for(let Re=0;Re<D.length;Re+=1)D[Re].l(Ie);Ie.forEach(u),Ee=L(ee),g=d(ee,"NAV",{class:!0});var _e=y(g);G=d(_e,"LABEL",{for:!0,"data-svelte-h":!0}),ae(G)!=="svelte-1r8oyu6"&&(G.textContent=le),j=L(_e),ge($.$$.fragment,_e),Y=W(_e,`
      of `),Z=W(_e,H),_e.forEach(u),ee.forEach(u),de=L(q),S&&S.l(q),q.forEach(u),this.h()},h(){c(o,"for","filter-type"),b.__value="SCHEDULED",Pe(b,b.__value),k.__value="DEAD",Pe(k,k.__value),w.__value="RUNNING",Pe(w,w.__value),c(r,"name","type"),c(r,"id","filter-type"),e[0].type===void 0&&ut(()=>e[9].call(r)),c(v,"class","svelte-1m1ug4d"),c(_,"id","filters"),c(_,"class","svelte-1m1ug4d"),c(i,"class","filters svelte-1m1ug4d"),c(M,"class","id svelte-1m1ug4d"),c(U,"class","svelte-1m1ug4d"),c(J,"class","svelte-1m1ug4d"),c(K,"class","svelte-1m1ug4d"),c(A,"class","svelte-1m1ug4d"),c(G,"for","page"),c(g,"class","pagination svelte-1m1ug4d"),c(s,"class","svelte-1m1ug4d"),c(n,"class","container svelte-1m1ug4d")},m(m,T){Q(m,a,T),Q(m,n,T),l(n,s),l(s,i),l(i,_),l(_,v),l(v,o),l(v,h),l(v,r),l(r,b),l(r,k),l(r,w),Je(r,e[0].type,!0),e[10](_),l(s,E),l(s,A),l(A,K),l(K,R),l(R,M),l(R,se),l(R,U),l(R,F),l(R,J),x.m(J,null),l(A,ue);for(let q=0;q<D.length;q+=1)D[q]&&D[q].m(A,null);l(s,Ee),l(s,g),l(g,G),l(g,j),pe($,g,null),l(g,Y),l(g,Z),l(n,de),S&&S.m(n,null),O=!0,fe||(ye=[he(r,"change",e[9]),he(r,"change",function(){He(e[3].requestSubmit())&&e[3].requestSubmit().apply(this,arguments)})],fe=!0)},p(m,[T]){var ee;if(e=m,(!O||T&32)&&t!==(t="Jobs"+((ee=e[5].online)!=null&&ee.MPKIT_URL?": "+e[5].online.MPKIT_URL.replace("https://",""):""))&&(document.title=t),T&1&&Je(r,e[0].type),re!==(re=$e(e))&&(x.d(1),x=re(e),x&&(x.c(),x.m(J,null))),T&87){oe=Ke(e[1].results);let I;for(I=0;I<oe.length;I+=1){const ke=Ge(e,oe,I);D[I]?(D[I].p(ke,T),B(D[I],1)):(D[I]=We(ke),D[I].c(),B(D[I],1),D[I].m(A,null))}for(xe(),I=oe.length;I<D.length;I+=1)et(I);Ze()}const q={};T&2&&(q.max=e[1].total_pages),!C&&T&1&&(C=!0,q.value=e[0].page,lt(()=>C=!1)),$.$set(q),(!O||T&2)&&H!==(H=(e[1].total_pages||1)+"")&&De(Z,H),S&&S.p&&(!O||T&128)&&rt(S,Ne,e,e[7],O?it(Ne,e[7],T,null):ot(e[7]),null)},i(m){if(!O){for(let T=0;T<oe.length;T+=1)B(D[T]);B($.$$.fragment,m),B(S,m),O=!0}},o(m){D=D.filter(Boolean);for(let T=0;T<D.length;T+=1)V(D[T]);V($.$$.fragment,m),V(S,m),O=!1},d(m){m&&(u(a),u(n)),e[10](null),x.d(),st(D,m),me($),S&&S.d(m),fe=!1,Ye(ye)}}}function Tt(e,t,a){let n,s;Ve(e,_t,E=>a(4,n=E)),Ve(e,Ce,E=>a(5,s=E));let{$$slots:i={},$$scope:_}=t,v={results:[]},o={id:null},p={page:1,type:"SCHEDULED",...Object.fromEntries(n.url.searchParams)},h,r;const b=async()=>{clearInterval(r),a(1,v=await Me.get(p)),r=setInterval(()=>{v.results.forEach(E=>{p.type==="DEAD"?E.dead_at_parsed=be(new Date(E.dead_at)):E.run_at_parsed=be(new Date(E.run_at))})},1e3)};ft(()=>{clearInterval(r)});function P(){p.type=ct(this),a(0,p)}function k(E){Le[E?"unshift":"push"](()=>{h=E,a(3,h)})}const te=E=>a(2,o.id=E.id,o),w=()=>a(2,o.id=null,o);function z(E){e.$$.not_equal(p.page,E)&&(p.page=E,a(0,p))}return e.$$set=E=>{"$$scope"in E&&a(7,_=E.$$scope)},e.$$.update=()=>{e.$$.dirty&1&&p&&b()},[p,v,o,h,n,s,b,_,i,P,k,te,w,z]}class Mt extends Ue{constructor(t){super(),je(this,t,Tt,Ct,Ae,{})}}export{Mt as component};
