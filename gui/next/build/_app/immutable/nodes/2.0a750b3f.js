import{s as Ne,f as d,a as I,l as Y,g as f,h as y,c as L,m as Z,d as u,j as c,i as x,v as l,x as me,H as Qe,p as Te,I as Oe,D as et,J as tt,r as ie,K as Fe,B as at,L as qe,M as nt,n as $e,E as st,F as lt,G as rt,N as ot,y as We,w as He,O as it,u as Je,P as ut}from"../chunks/scheduler.771e17c8.js";import{S as Pe,i as Re,b as pe,d as he,m as ge,a as F,t as G,e as ve,h as dt,c as Xe,g as Ye}from"../chunks/index.25a56fcb.js";import{e as Ve}from"../chunks/each.066ee579.js";import"../chunks/singletons.4c806f9a.js";import{p as ft}from"../chunks/stores.3f9dd56f.js";import{b as je}from"../chunks/backgroundJob.a61b4e2d.js";import{s as De}from"../chunks/state.2c4ca62b.js";import{I as Ae}from"../chunks/Icon.34c6ba11.js";import{N as ct}from"../chunks/Number.b0aee45b.js";const be=e=>{const t=e instanceof Date?e:new Date(e),a=new Intl.RelativeTimeFormat("en"),n={years:3600*24*365,months:3600*24*30,weeks:3600*24*7,days:3600*24,hours:3600,minutes:60,seconds:1},s=(t.getTime()-Date.now())/1e3;for(let i in n)if(n[i]<Math.abs(s)){const _=s/n[i];return a.format(Math.round(_),i)}};function _t(e){let t,a,n,s,i,_,p,r,h;return i=new Ae({props:{icon:"refresh",size:"22"}}),{c(){t=d("form"),a=d("input"),n=I(),s=d("button"),pe(i.$$.fragment),_=Y(`\r
    Retry`),this.h()},l(g){t=f(g,"FORM",{});var o=y(t);a=f(o,"INPUT",{type:!0,name:!0}),n=L(o),s=f(o,"BUTTON",{class:!0});var b=y(s);he(i.$$.fragment,b),_=Z(b,`\r
    Retry`),b.forEach(u),o.forEach(u),this.h()},h(){c(a,"type","hidden"),c(a,"name","id"),a.value=e[0],c(s,"class","danger")},m(g,o){x(g,t,o),l(t,a),l(t,n),l(t,s),ge(i,s,null),l(s,_),e[3](t),p=!0,r||(h=me(t,"submit",e[2]),r=!0)},p(g,[o]){(!p||o&1)&&(a.value=g[0])},i(g){p||(F(i.$$.fragment,g),p=!0)},o(g){G(i.$$.fragment,g),p=!1},d(g){g&&u(t),ve(i),e[3](null),r=!1,h()}}}function mt(e,t,a){let{id:n}=t,s;const i=Qe(),_=async r=>{r.preventDefault();const h=await je.retry({properties:new FormData(s)});h.errors?De.notification.create("error",`Background job ${h.admin_background_job_retry.id} could not be run again`):(i("itemsChanged"),De.notification.create("success",`Background job ${h.admin_background_job_retry.id} planned to run again`))};function p(r){Te[r?"unshift":"push"](()=>{s=r,a(1,s)})}return e.$$set=r=>{"id"in r&&a(0,n=r.id)},[n,s,_,p]}class pt extends Pe{constructor(t){super(),Re(this,t,mt,_t,Ne,{id:0})}}function ht(e){let t,a,n,s,i,_,p,r,h,g;return _=new Ae({props:{icon:"x",size:"22"}}),{c(){t=d("form"),a=d("input"),n=I(),s=d("button"),i=d("i"),pe(_.$$.fragment),p=Y(`\r
    Delete background job`),this.h()},l(o){t=f(o,"FORM",{});var b=y(t);a=f(b,"INPUT",{type:!0,name:!0}),n=L(b),s=f(b,"BUTTON",{class:!0});var P=y(s);i=f(P,"I",{class:!0});var $=y(i);he(_.$$.fragment,$),$.forEach(u),p=Z(P,`\r
    Delete background job`),P.forEach(u),b.forEach(u),this.h()},h(){c(a,"type","hidden"),c(a,"name","id"),a.value=e[0],c(i,"class","svelte-ooaugn"),c(s,"class","danger")},m(o,b){x(o,t,b),l(t,a),l(t,n),l(t,s),l(s,i),ge(_,i,null),l(s,p),e[3](t),r=!0,h||(g=me(t,"submit",e[2]),h=!0)},p(o,[b]){(!r||b&1)&&(a.value=o[0])},i(o){r||(F(_.$$.fragment,o),r=!0)},o(o){G(_.$$.fragment,o),r=!1},d(o){o&&u(t),ve(_),e[3](null),h=!1,g()}}}function gt(e,t,a){let{id:n}=t,s;const i=Qe(),_=async r=>{if(r.preventDefault(),confirm("Are you sure you want to delete this background job?")){const h=await je.delete({properties:new FormData(s)});h.errors?De.notification.create("error",`Background job ${h.admin_background_job_delete.id} could not be deleted`):(i("itemsChanged"),De.notification.create("success",`Background job ${h.admin_background_job_delete.id} deleted`))}};function p(r){Te[r?"unshift":"push"](()=>{s=r,a(1,s)})}return e.$$set=r=>{"id"in r&&a(0,n=r.id)},[n,s,_,p]}class vt extends Pe{constructor(t){super(),Re(this,t,gt,ht,Ne,{id:0})}}function Ke(e,t,a){const n=e.slice();return n[16]=t[a],n}function bt(e){let t;return{c(){t=Y("Runs")},l(a){t=Z(a,"Runs")},m(a,n){x(a,t,n)},d(a){a&&u(t)}}}function yt(e){let t;return{c(){t=Y("Failed")},l(a){t=Z(a,"Failed")},m(a,n){x(a,t,n)},d(a){a&&u(t)}}}function ze(e){let t,a,n;return a=new pt({props:{id:e[16].id}}),a.$on("itemsChanged",e[6]),{c(){t=d("li"),pe(a.$$.fragment),this.h()},l(s){t=f(s,"LI",{class:!0});var i=y(t);he(a.$$.fragment,i),i.forEach(u),this.h()},h(){c(t,"class","svelte-1m1ug4d")},m(s,i){x(s,t,i),ge(a,t,null),n=!0},p(s,i){const _={};i&2&&(_.id=s[16].id),a.$set(_)},i(s){n||(F(a.$$.fragment,s),n=!0)},o(s){G(a.$$.fragment,s),n=!1},d(s){s&&u(t),ve(a)}}}function Et(e){let t=(e[16].run_at_parsed||be(new Date(e[16].run_at)))+"",a;return{c(){a=Y(t)},l(n){a=Z(n,t)},m(n,s){x(n,a,s)},p(n,s){s&2&&t!==(t=(n[16].run_at_parsed||be(new Date(n[16].run_at)))+"")&&$e(a,t)},d(n){n&&u(a)}}}function $t(e){let t=(e[16].dead_at_parsed||be(new Date(e[16].dead_at))||"")+"",a;return{c(){a=Y(t)},l(n){a=Z(n,t)},m(n,s){x(n,a,s)},p(n,s){s&2&&t!==(t=(n[16].dead_at_parsed||be(new Date(n[16].dead_at))||"")+"")&&$e(a,t)},d(n){n&&u(a)}}}function Ge(e){let t,a,n,s,i,_="More options",p,r,h,g,o,b,P,$,se,A,N=(e[16].source_name||e[16].id)+"",v,M,V,ee,te=e[16].queue+"",q,ue,K,z,H,le,S;r=new Ae({props:{icon:"navigationMenuVertical",size:"16"}});function ae(){return e[11](e[16])}let k=e[16].dead_at&&ze(e);$=new vt({props:{id:e[16].id}}),$.$on("itemsChanged",e[6]);function de(T,E){return T[0].type==="DEAD"?$t:Et}let R=de(e),j=R(e);return{c(){t=d("tr"),a=d("td"),n=d("div"),s=d("button"),i=d("span"),i.textContent=_,p=I(),pe(r.$$.fragment),h=I(),g=d("menu"),o=d("ul"),k&&k.c(),b=I(),P=d("li"),pe($.$$.fragment),se=I(),A=d("a"),v=Y(N),V=I(),ee=d("td"),q=Y(te),ue=I(),K=d("td"),j.c(),z=I(),this.h()},l(T){t=f(T,"TR",{class:!0});var E=y(t);a=f(E,"TD",{class:!0});var Q=y(a);n=f(Q,"DIV",{class:!0});var W=y(n);s=f(W,"BUTTON",{class:!0});var U=y(s);i=f(U,"SPAN",{class:!0,"data-svelte-h":!0}),ie(i)!=="svelte-1agpmtc"&&(i.textContent=_),p=L(U),he(r.$$.fragment,U),U.forEach(u),h=L(W),g=f(W,"MENU",{class:!0});var fe=y(g);o=f(fe,"UL",{});var re=y(o);k&&k.l(re),b=L(re),P=f(re,"LI",{class:!0});var ye=y(P);he($.$$.fragment,ye),ye.forEach(u),re.forEach(u),fe.forEach(u),se=L(W),A=f(W,"A",{href:!0,class:!0});var oe=y(A);v=Z(oe,N),oe.forEach(u),W.forEach(u),Q.forEach(u),V=L(E),ee=f(E,"TD",{class:!0});var J=y(ee);q=Z(J,te),J.forEach(u),ue=L(E),K=f(E,"TD",{class:!0});var X=y(K);j.l(X),X.forEach(u),z=L(E),E.forEach(u),this.h()},h(){c(i,"class","label"),c(s,"class","button compact more svelte-1m1ug4d"),c(P,"class","svelte-1m1ug4d"),c(g,"class","content-context svelte-1m1ug4d"),Je(g,"active",e[2].id===e[16].id),c(A,"href",M="/backgroundJobs/"+e[0].type.toLowerCase()+"/"+e[16].id+"?"+e[4].url.searchParams.toString()),c(A,"class","svelte-1m1ug4d"),c(n,"class","svelte-1m1ug4d"),c(a,"class","id svelte-1m1ug4d"),c(ee,"class","svelte-1m1ug4d"),c(K,"class","svelte-1m1ug4d"),c(t,"class","svelte-1m1ug4d")},m(T,E){x(T,t,E),l(t,a),l(a,n),l(n,s),l(s,i),l(s,p),ge(r,s,null),l(n,h),l(n,g),l(g,o),k&&k.m(o,null),l(o,b),l(o,P),ge($,P,null),l(n,se),l(n,A),l(A,v),l(t,V),l(t,ee),l(ee,q),l(t,ue),l(t,K),j.m(K,null),l(t,z),H=!0,le||(S=[me(s,"click",ae),me(a,"mouseleave",e[12])],le=!0)},p(T,E){e=T,e[16].dead_at?k?(k.p(e,E),E&2&&F(k,1)):(k=ze(e),k.c(),F(k,1),k.m(o,b)):k&&(Ye(),G(k,1,1,()=>{k=null}),Xe());const Q={};E&2&&(Q.id=e[16].id),$.$set(Q),(!H||E&6)&&Je(g,"active",e[2].id===e[16].id),(!H||E&2)&&N!==(N=(e[16].source_name||e[16].id)+"")&&$e(v,N),(!H||E&19&&M!==(M="/backgroundJobs/"+e[0].type.toLowerCase()+"/"+e[16].id+"?"+e[4].url.searchParams.toString()))&&c(A,"href",M),(!H||E&2)&&te!==(te=e[16].queue+"")&&$e(q,te),R===(R=de(e))&&j?j.p(e,E):(j.d(1),j=R(e),j&&(j.c(),j.m(K,null)))},i(T){H||(F(r.$$.fragment,T),F(k),F($.$$.fragment,T),H=!0)},o(T){G(r.$$.fragment,T),G(k),G($.$$.fragment,T),H=!1},d(T){T&&u(t),ve(r),k&&k.d(),ve($),j.d(),le=!1,We(S)}}}function Dt(e){var Se;let t,a,n,s,i,_,p,r,h="Type:",g,o,b,P="Scheduled",$,se="Failed",A,N,v,M,V,ee="Name / id",te,q,ue="Priority",K,z,H,le,S,ae,k="Page:",de,R,j,T,E=(e[1].total_pages||1)+"",Q,W,U,fe,re;document.title=t="Jobs"+((Se=e[5].online)!=null&&Se.MPKIT_URL?": "+e[5].online.MPKIT_URL.replace("https://",""):"");function ye(m,C){return m[0].type==="DEAD"?yt:bt}let oe=ye(e),J=oe(e),X=Ve(e[1].results),D=[];for(let m=0;m<X.length;m+=1)D[m]=Ge(Ke(e,X,m));const Ze=m=>G(D[m],1,1,()=>{D[m]=null});function xe(m){e[13](m)}let Me={form:"filters",name:"page",min:1,max:e[1].total_pages,step:1,decreaseLabel:"Previous page",increaseLabel:"Next page",style:"navigation"};e[0].page!==void 0&&(Me.value=e[0].page),R=new ct({props:Me}),Te.push(()=>dt(R,"value",xe)),R.$on("input",function(){Oe(e[3].requestSubmit())&&e[3].requestSubmit().apply(this,arguments)});const we=e[8].default,B=et(we,e,e[7],null);return{c(){a=I(),n=d("div"),s=d("div"),i=d("nav"),_=d("form"),p=d("fieldset"),r=d("label"),r.textContent=h,g=I(),o=d("select"),b=d("option"),b.textContent=P,$=d("option"),$.textContent=se,A=I(),N=d("table"),v=d("thead"),M=d("tr"),V=d("th"),V.textContent=ee,te=I(),q=d("th"),q.textContent=ue,K=I(),z=d("th"),J.c(),H=I();for(let m=0;m<D.length;m+=1)D[m].c();le=I(),S=d("nav"),ae=d("label"),ae.textContent=k,de=I(),pe(R.$$.fragment),T=Y(`
      of `),Q=Y(E),W=I(),B&&B.c(),this.h()},l(m){tt("svelte-qj8tye",document.head).forEach(u),a=L(m),n=f(m,"DIV",{class:!0});var O=y(n);s=f(O,"DIV",{class:!0});var ne=y(s);i=f(ne,"NAV",{class:!0});var w=y(i);_=f(w,"FORM",{id:!0,class:!0});var Ee=y(_);p=f(Ee,"FIELDSET",{class:!0});var ke=y(p);r=f(ke,"LABEL",{for:!0,"data-svelte-h":!0}),ie(r)!=="svelte-iw296f"&&(r.textContent=h),g=L(ke),o=f(ke,"SELECT",{name:!0,id:!0});var Ie=y(o);b=f(Ie,"OPTION",{"data-svelte-h":!0}),ie(b)!=="svelte-1nu502o"&&(b.textContent=P),$=f(Ie,"OPTION",{"data-svelte-h":!0}),ie($)!=="svelte-105yz3n"&&($.textContent=se),Ie.forEach(u),ke.forEach(u),Ee.forEach(u),w.forEach(u),A=L(ne),N=f(ne,"TABLE",{class:!0});var Ce=y(N);v=f(Ce,"THEAD",{class:!0});var Ue=y(v);M=f(Ue,"TR",{});var ce=y(M);V=f(ce,"TH",{class:!0,"data-svelte-h":!0}),ie(V)!=="svelte-17wqap5"&&(V.textContent=ee),te=L(ce),q=f(ce,"TH",{class:!0,"data-svelte-h":!0}),ie(q)!=="svelte-wgplya"&&(q.textContent=ue),K=L(ce),z=f(ce,"TH",{class:!0});var Be=y(z);J.l(Be),Be.forEach(u),ce.forEach(u),Ue.forEach(u),H=L(Ce);for(let Le=0;Le<D.length;Le+=1)D[Le].l(Ce);Ce.forEach(u),le=L(ne),S=f(ne,"NAV",{class:!0});var _e=y(S);ae=f(_e,"LABEL",{for:!0,"data-svelte-h":!0}),ie(ae)!=="svelte-1r8oyu6"&&(ae.textContent=k),de=L(_e),he(R.$$.fragment,_e),T=Z(_e,`
      of `),Q=Z(_e,E),_e.forEach(u),ne.forEach(u),W=L(O),B&&B.l(O),O.forEach(u),this.h()},h(){c(r,"for","filter-type"),b.__value="SCHEDULED",Fe(b,b.__value),$.__value="DEAD",Fe($,$.__value),c(o,"name","type"),c(o,"id","filter-type"),e[0].type===void 0&&at(()=>e[9].call(o)),c(p,"class","svelte-1m1ug4d"),c(_,"id","filters"),c(_,"class","svelte-1m1ug4d"),c(i,"class","filters svelte-1m1ug4d"),c(V,"class","id svelte-1m1ug4d"),c(q,"class","svelte-1m1ug4d"),c(z,"class","svelte-1m1ug4d"),c(v,"class","svelte-1m1ug4d"),c(N,"class","svelte-1m1ug4d"),c(ae,"for","page"),c(S,"class","pagination svelte-1m1ug4d"),c(s,"class","svelte-1m1ug4d"),c(n,"class","container svelte-1m1ug4d")},m(m,C){x(m,a,C),x(m,n,C),l(n,s),l(s,i),l(i,_),l(_,p),l(p,r),l(p,g),l(p,o),l(o,b),l(o,$),qe(o,e[0].type,!0),e[10](_),l(s,A),l(s,N),l(N,v),l(v,M),l(M,V),l(M,te),l(M,q),l(M,K),l(M,z),J.m(z,null),l(N,H);for(let O=0;O<D.length;O+=1)D[O]&&D[O].m(N,null);l(s,le),l(s,S),l(S,ae),l(S,de),ge(R,S,null),l(S,T),l(S,Q),l(n,W),B&&B.m(n,null),U=!0,fe||(re=[me(o,"change",e[9]),me(o,"change",function(){Oe(e[3].requestSubmit())&&e[3].requestSubmit().apply(this,arguments)})],fe=!0)},p(m,[C]){var ne;if(e=m,(!U||C&32)&&t!==(t="Jobs"+((ne=e[5].online)!=null&&ne.MPKIT_URL?": "+e[5].online.MPKIT_URL.replace("https://",""):""))&&(document.title=t),C&1&&qe(o,e[0].type),oe!==(oe=ye(e))&&(J.d(1),J=oe(e),J&&(J.c(),J.m(z,null))),C&87){X=Ve(e[1].results);let w;for(w=0;w<X.length;w+=1){const Ee=Ke(e,X,w);D[w]?(D[w].p(Ee,C),F(D[w],1)):(D[w]=Ge(Ee),D[w].c(),F(D[w],1),D[w].m(N,null))}for(Ye(),w=X.length;w<D.length;w+=1)Ze(w);Xe()}const O={};C&2&&(O.max=e[1].total_pages),!j&&C&1&&(j=!0,O.value=e[0].page,nt(()=>j=!1)),R.$set(O),(!U||C&2)&&E!==(E=(e[1].total_pages||1)+"")&&$e(Q,E),B&&B.p&&(!U||C&128)&&st(B,we,e,e[7],U?rt(we,e[7],C,null):lt(e[7]),null)},i(m){if(!U){for(let C=0;C<X.length;C+=1)F(D[C]);F(R.$$.fragment,m),F(B,m),U=!0}},o(m){D=D.filter(Boolean);for(let C=0;C<D.length;C+=1)G(D[C]);G(R.$$.fragment,m),G(B,m),U=!1},d(m){m&&(u(a),u(n)),e[10](null),J.d(),ot(D,m),ve(R),B&&B.d(m),fe=!1,We(re)}}}function kt(e,t,a){let n,s;He(e,ft,v=>a(4,n=v)),He(e,De,v=>a(5,s=v));let{$$slots:i={},$$scope:_}=t,p={results:[]},r={id:null},h={page:1,type:"SCHEDULED",...Object.fromEntries(n.url.searchParams)},g,o;const b=async()=>{clearInterval(o),a(1,p=await je.get(h)),console.log(p),o=setInterval(()=>{p.results.forEach(v=>{h.type==="DEAD"?v.dead_at_parsed=be(new Date(v.dead_at)):v.run_at_parsed=be(new Date(v.run_at))})},1e3)};it(()=>{clearInterval(o)});function P(){h.type=ut(this),a(0,h)}function $(v){Te[v?"unshift":"push"](()=>{g=v,a(3,g)})}const se=v=>a(2,r.id=v.id,r),A=()=>a(2,r.id=null,r);function N(v){e.$$.not_equal(h.page,v)&&(h.page=v,a(0,h))}return e.$$set=v=>{"$$scope"in v&&a(7,_=v.$$scope)},e.$$.update=()=>{e.$$.dirty&1&&h&&b()},[h,p,r,g,n,s,b,_,i,P,$,se,A,N]}class At extends Pe{constructor(t){super(),Re(this,t,kt,Dt,Ne,{})}}export{At as component};
