import{s as Le,f as d,a as I,l as Y,g as f,h as E,c as L,m as Z,d as u,j as c,i as x,v as l,x as _e,H as Ge,p as Ce,I as Be,D as xe,J as et,r as oe,K as Oe,B as tt,L as Fe,M as at,n as ye,E as nt,F as st,G as lt,N as rt,y as Qe,w as qe,O as ot,u as He,P as it}from"../chunks/scheduler.C43H4T0F.js";import{S as Ne,i as Pe,b as me,d as he,m as pe,a as F,t as G,e as ge,h as ut,c as We,g as Xe}from"../chunks/index.JUyE3YTa.js";import{e as Je}from"../chunks/each.7MJCLYVi.js";import"../chunks/singletons.eat3Zqle.js";import{p as dt}from"../chunks/stores.huzHbPoc.js";import{b as Re}from"../chunks/backgroundJob.NGLWULbh.js";import{s as $e}from"../chunks/state.FTiieUpz.js";import{I as je}from"../chunks/Icon.HnzAYZiZ.js";import{N as ft}from"../chunks/Number.vfOsQ1lO.js";const ve=e=>{const t=e instanceof Date?e:new Date(e),a=new Intl.RelativeTimeFormat("en"),n={years:3600*24*365,months:3600*24*30,weeks:3600*24*7,days:3600*24,hours:3600,minutes:60,seconds:1},s=(t.getTime()-Date.now())/1e3;for(let i in n)if(n[i]<Math.abs(s)){const _=s/n[i];return a.format(Math.round(_),i)}};function ct(e){let t,a,n,s,i,_,h,r,p;return i=new je({props:{icon:"refresh",size:"22"}}),{c(){t=d("form"),a=d("input"),n=I(),s=d("button"),me(i.$$.fragment),_=Y(`\r
    Retry`),this.h()},l(g){t=f(g,"FORM",{});var o=E(t);a=f(o,"INPUT",{type:!0,name:!0}),n=L(o),s=f(o,"BUTTON",{class:!0});var b=E(s);he(i.$$.fragment,b),_=Z(b,`\r
    Retry`),b.forEach(u),o.forEach(u),this.h()},h(){c(a,"type","hidden"),c(a,"name","id"),a.value=e[0],c(s,"class","danger")},m(g,o){x(g,t,o),l(t,a),l(t,n),l(t,s),pe(i,s,null),l(s,_),e[3](t),h=!0,r||(p=_e(t,"submit",e[2]),r=!0)},p(g,[o]){(!h||o&1)&&(a.value=g[0])},i(g){h||(F(i.$$.fragment,g),h=!0)},o(g){G(i.$$.fragment,g),h=!1},d(g){g&&u(t),ge(i),e[3](null),r=!1,p()}}}function _t(e,t,a){let{id:n}=t,s;const i=Ge(),_=async r=>{r.preventDefault();const p=await Re.retry({properties:new FormData(s)});p.errors?$e.notification.create("error",`Background job ${p.admin_background_job_retry.id} could not be run again`):(i("itemsChanged"),$e.notification.create("success",`Background job ${p.admin_background_job_retry.id} planned to run again`))};function h(r){Ce[r?"unshift":"push"](()=>{s=r,a(1,s)})}return e.$$set=r=>{"id"in r&&a(0,n=r.id)},[n,s,_,h]}class mt extends Ne{constructor(t){super(),Pe(this,t,_t,ct,Le,{id:0})}}function ht(e){let t,a,n,s,i,_,h,r,p,g;return _=new je({props:{icon:"x",size:"22"}}),{c(){t=d("form"),a=d("input"),n=I(),s=d("button"),i=d("i"),me(_.$$.fragment),h=Y(`\r
    Delete background job`),this.h()},l(o){t=f(o,"FORM",{});var b=E(t);a=f(b,"INPUT",{type:!0,name:!0}),n=L(b),s=f(b,"BUTTON",{class:!0});var P=E(s);i=f(P,"I",{class:!0});var $=E(i);he(_.$$.fragment,$),$.forEach(u),h=Z(P,`\r
    Delete background job`),P.forEach(u),b.forEach(u),this.h()},h(){c(a,"type","hidden"),c(a,"name","id"),a.value=e[0],c(i,"class","svelte-ooaugn"),c(s,"class","danger")},m(o,b){x(o,t,b),l(t,a),l(t,n),l(t,s),l(s,i),pe(_,i,null),l(s,h),e[3](t),r=!0,p||(g=_e(t,"submit",e[2]),p=!0)},p(o,[b]){(!r||b&1)&&(a.value=o[0])},i(o){r||(F(_.$$.fragment,o),r=!0)},o(o){G(_.$$.fragment,o),r=!1},d(o){o&&u(t),ge(_),e[3](null),p=!1,g()}}}function pt(e,t,a){let{id:n}=t,s;const i=Ge(),_=async r=>{if(r.preventDefault(),confirm("Are you sure you want to delete this background job?")){const p=await Re.delete({properties:new FormData(s)});p.errors?$e.notification.create("error",`Background job ${p.admin_background_job_delete.id} could not be deleted`):(i("itemsChanged"),$e.notification.create("success",`Background job ${p.admin_background_job_delete.id} deleted`))}};function h(r){Ce[r?"unshift":"push"](()=>{s=r,a(1,s)})}return e.$$set=r=>{"id"in r&&a(0,n=r.id)},[n,s,_,h]}class gt extends Ne{constructor(t){super(),Pe(this,t,pt,ht,Le,{id:0})}}function Ve(e,t,a){const n=e.slice();return n[16]=t[a],n}function vt(e){let t;return{c(){t=Y("Runs")},l(a){t=Z(a,"Runs")},m(a,n){x(a,t,n)},d(a){a&&u(t)}}}function bt(e){let t;return{c(){t=Y("Failed")},l(a){t=Z(a,"Failed")},m(a,n){x(a,t,n)},d(a){a&&u(t)}}}function Ke(e){let t,a,n;return a=new mt({props:{id:e[16].id}}),a.$on("itemsChanged",e[6]),{c(){t=d("li"),me(a.$$.fragment),this.h()},l(s){t=f(s,"LI",{class:!0});var i=E(t);he(a.$$.fragment,i),i.forEach(u),this.h()},h(){c(t,"class","svelte-1m1ug4d")},m(s,i){x(s,t,i),pe(a,t,null),n=!0},p(s,i){const _={};i&2&&(_.id=s[16].id),a.$set(_)},i(s){n||(F(a.$$.fragment,s),n=!0)},o(s){G(a.$$.fragment,s),n=!1},d(s){s&&u(t),ge(a)}}}function Et(e){let t=(e[16].run_at_parsed||ve(new Date(e[16].run_at)))+"",a;return{c(){a=Y(t)},l(n){a=Z(n,t)},m(n,s){x(n,a,s)},p(n,s){s&2&&t!==(t=(n[16].run_at_parsed||ve(new Date(n[16].run_at)))+"")&&ye(a,t)},d(n){n&&u(a)}}}function yt(e){let t=(e[16].dead_at_parsed||ve(new Date(e[16].dead_at))||"")+"",a;return{c(){a=Y(t)},l(n){a=Z(n,t)},m(n,s){x(n,a,s)},p(n,s){s&2&&t!==(t=(n[16].dead_at_parsed||ve(new Date(n[16].dead_at))||"")+"")&&ye(a,t)},d(n){n&&u(a)}}}function ze(e){let t,a,n,s,i,_="More options",h,r,p,g,o,b,P,$,ne,A,N=(e[16].source_name||e[16].id)+"",v,M,V,ee,te=e[16].queue+"",q,ie,K,z,H,se,S;r=new je({props:{icon:"navigationMenuVertical",size:"16"}});function ae(){return e[11](e[16])}let k=e[16].dead_at&&Ke(e);$=new gt({props:{id:e[16].id}}),$.$on("itemsChanged",e[6]);function ue(w,y){return w[0].type==="DEAD"?yt:Et}let R=ue(e),j=R(e);return{c(){t=d("tr"),a=d("td"),n=d("div"),s=d("button"),i=d("span"),i.textContent=_,h=I(),me(r.$$.fragment),p=I(),g=d("menu"),o=d("ul"),k&&k.c(),b=I(),P=d("li"),me($.$$.fragment),ne=I(),A=d("a"),v=Y(N),V=I(),ee=d("td"),q=Y(te),ie=I(),K=d("td"),j.c(),z=I(),this.h()},l(w){t=f(w,"TR",{class:!0});var y=E(t);a=f(y,"TD",{class:!0});var Q=E(a);n=f(Q,"DIV",{class:!0});var W=E(n);s=f(W,"BUTTON",{class:!0});var U=E(s);i=f(U,"SPAN",{class:!0,"data-svelte-h":!0}),oe(i)!=="svelte-1agpmtc"&&(i.textContent=_),h=L(U),he(r.$$.fragment,U),U.forEach(u),p=L(W),g=f(W,"MENU",{class:!0});var de=E(g);o=f(de,"UL",{});var le=E(o);k&&k.l(le),b=L(le),P=f(le,"LI",{class:!0});var be=E(P);he($.$$.fragment,be),be.forEach(u),le.forEach(u),de.forEach(u),ne=L(W),A=f(W,"A",{href:!0,class:!0});var re=E(A);v=Z(re,N),re.forEach(u),W.forEach(u),Q.forEach(u),V=L(y),ee=f(y,"TD",{class:!0});var J=E(ee);q=Z(J,te),J.forEach(u),ie=L(y),K=f(y,"TD",{class:!0});var X=E(K);j.l(X),X.forEach(u),z=L(y),y.forEach(u),this.h()},h(){c(i,"class","label"),c(s,"class","button compact more svelte-1m1ug4d"),c(P,"class","svelte-1m1ug4d"),c(g,"class","content-context svelte-1m1ug4d"),He(g,"active",e[2].id===e[16].id),c(A,"href",M="/backgroundJobs/"+e[0].type.toLowerCase()+"/"+e[16].id+"?"+e[4].url.searchParams.toString()),c(A,"class","svelte-1m1ug4d"),c(n,"class","svelte-1m1ug4d"),c(a,"class","id svelte-1m1ug4d"),c(ee,"class","svelte-1m1ug4d"),c(K,"class","svelte-1m1ug4d"),c(t,"class","svelte-1m1ug4d")},m(w,y){x(w,t,y),l(t,a),l(a,n),l(n,s),l(s,i),l(s,h),pe(r,s,null),l(n,p),l(n,g),l(g,o),k&&k.m(o,null),l(o,b),l(o,P),pe($,P,null),l(n,ne),l(n,A),l(A,v),l(t,V),l(t,ee),l(ee,q),l(t,ie),l(t,K),j.m(K,null),l(t,z),H=!0,se||(S=[_e(s,"click",ae),_e(a,"mouseleave",e[12])],se=!0)},p(w,y){e=w,e[16].dead_at?k?(k.p(e,y),y&2&&F(k,1)):(k=Ke(e),k.c(),F(k,1),k.m(o,b)):k&&(Xe(),G(k,1,1,()=>{k=null}),We());const Q={};y&2&&(Q.id=e[16].id),$.$set(Q),(!H||y&6)&&He(g,"active",e[2].id===e[16].id),(!H||y&2)&&N!==(N=(e[16].source_name||e[16].id)+"")&&ye(v,N),(!H||y&19&&M!==(M="/backgroundJobs/"+e[0].type.toLowerCase()+"/"+e[16].id+"?"+e[4].url.searchParams.toString()))&&c(A,"href",M),(!H||y&2)&&te!==(te=e[16].queue+"")&&ye(q,te),R===(R=ue(e))&&j?j.p(e,y):(j.d(1),j=R(e),j&&(j.c(),j.m(K,null)))},i(w){H||(F(r.$$.fragment,w),F(k),F($.$$.fragment,w),H=!0)},o(w){G(r.$$.fragment,w),G(k),G($.$$.fragment,w),H=!1},d(w){w&&u(t),ge(r),k&&k.d(),ge($),j.d(),se=!1,Qe(S)}}}function $t(e){let t,a,n,s,i,_,h,r,p="Type:",g,o,b,P="Scheduled",$,ne="Failed",A,N,v,M,V,ee="Name / id",te,q,ie="Priority",K,z,H,se,S,ae,k="Page:",ue,R,j,w,y=(e[1].total_pages||1)+"",Q,W,U,de,le;document.title=t="Jobs"+(e[5].online?.MPKIT_URL?": "+e[5].online.MPKIT_URL.replace("https://",""):"");function be(m,C){return m[0].type==="DEAD"?bt:vt}let re=be(e),J=re(e),X=Je(e[1].results),D=[];for(let m=0;m<X.length;m+=1)D[m]=ze(Ve(e,X,m));const Ye=m=>G(D[m],1,1,()=>{D[m]=null});function Ze(m){e[13](m)}let Ae={form:"filters",name:"page",min:1,max:e[1].total_pages,step:1,decreaseLabel:"Previous page",increaseLabel:"Next page",style:"navigation"};e[0].page!==void 0&&(Ae.value=e[0].page),R=new ft({props:Ae}),Ce.push(()=>ut(R,"value",Ze)),R.$on("input",function(){Be(e[3].requestSubmit())&&e[3].requestSubmit().apply(this,arguments)});const Te=e[8].default,B=xe(Te,e,e[7],null);return{c(){a=I(),n=d("div"),s=d("div"),i=d("nav"),_=d("form"),h=d("fieldset"),r=d("label"),r.textContent=p,g=I(),o=d("select"),b=d("option"),b.textContent=P,$=d("option"),$.textContent=ne,A=I(),N=d("table"),v=d("thead"),M=d("tr"),V=d("th"),V.textContent=ee,te=I(),q=d("th"),q.textContent=ie,K=I(),z=d("th"),J.c(),H=I();for(let m=0;m<D.length;m+=1)D[m].c();se=I(),S=d("nav"),ae=d("label"),ae.textContent=k,ue=I(),me(R.$$.fragment),w=Y(`\r
      of `),Q=Y(y),W=I(),B&&B.c(),this.h()},l(m){et("svelte-qj8tye",document.head).forEach(u),a=L(m),n=f(m,"DIV",{class:!0});var O=E(n);s=f(O,"DIV",{class:!0});var T=E(s);i=f(T,"NAV",{class:!0});var Ee=E(i);_=f(Ee,"FORM",{id:!0,class:!0});var Me=E(_);h=f(Me,"FIELDSET",{class:!0});var De=E(h);r=f(De,"LABEL",{for:!0,"data-svelte-h":!0}),oe(r)!=="svelte-iw296f"&&(r.textContent=p),g=L(De),o=f(De,"SELECT",{name:!0,id:!0});var we=E(o);b=f(we,"OPTION",{"data-svelte-h":!0}),oe(b)!=="svelte-1nu502o"&&(b.textContent=P),$=f(we,"OPTION",{"data-svelte-h":!0}),oe($)!=="svelte-105yz3n"&&($.textContent=ne),we.forEach(u),De.forEach(u),Me.forEach(u),Ee.forEach(u),A=L(T),N=f(T,"TABLE",{class:!0});var ke=E(N);v=f(ke,"THEAD",{class:!0});var Se=E(v);M=f(Se,"TR",{});var fe=E(M);V=f(fe,"TH",{class:!0,"data-svelte-h":!0}),oe(V)!=="svelte-17wqap5"&&(V.textContent=ee),te=L(fe),q=f(fe,"TH",{class:!0,"data-svelte-h":!0}),oe(q)!=="svelte-wgplya"&&(q.textContent=ie),K=L(fe),z=f(fe,"TH",{class:!0});var Ue=E(z);J.l(Ue),Ue.forEach(u),fe.forEach(u),Se.forEach(u),H=L(ke);for(let Ie=0;Ie<D.length;Ie+=1)D[Ie].l(ke);ke.forEach(u),se=L(T),S=f(T,"NAV",{class:!0});var ce=E(S);ae=f(ce,"LABEL",{for:!0,"data-svelte-h":!0}),oe(ae)!=="svelte-1r8oyu6"&&(ae.textContent=k),ue=L(ce),he(R.$$.fragment,ce),w=Z(ce,`\r
      of `),Q=Z(ce,y),ce.forEach(u),T.forEach(u),W=L(O),B&&B.l(O),O.forEach(u),this.h()},h(){c(r,"for","filter-type"),b.__value="SCHEDULED",Oe(b,b.__value),$.__value="DEAD",Oe($,$.__value),c(o,"name","type"),c(o,"id","filter-type"),e[0].type===void 0&&tt(()=>e[9].call(o)),c(h,"class","svelte-1m1ug4d"),c(_,"id","filters"),c(_,"class","svelte-1m1ug4d"),c(i,"class","filters svelte-1m1ug4d"),c(V,"class","id svelte-1m1ug4d"),c(q,"class","svelte-1m1ug4d"),c(z,"class","svelte-1m1ug4d"),c(v,"class","svelte-1m1ug4d"),c(N,"class","svelte-1m1ug4d"),c(ae,"for","page"),c(S,"class","pagination svelte-1m1ug4d"),c(s,"class","svelte-1m1ug4d"),c(n,"class","container svelte-1m1ug4d")},m(m,C){x(m,a,C),x(m,n,C),l(n,s),l(s,i),l(i,_),l(_,h),l(h,r),l(h,g),l(h,o),l(o,b),l(o,$),Fe(o,e[0].type,!0),e[10](_),l(s,A),l(s,N),l(N,v),l(v,M),l(M,V),l(M,te),l(M,q),l(M,K),l(M,z),J.m(z,null),l(N,H);for(let O=0;O<D.length;O+=1)D[O]&&D[O].m(N,null);l(s,se),l(s,S),l(S,ae),l(S,ue),pe(R,S,null),l(S,w),l(S,Q),l(n,W),B&&B.m(n,null),U=!0,de||(le=[_e(o,"change",e[9]),_e(o,"change",function(){Be(e[3].requestSubmit())&&e[3].requestSubmit().apply(this,arguments)})],de=!0)},p(m,[C]){if(e=m,(!U||C&32)&&t!==(t="Jobs"+(e[5].online?.MPKIT_URL?": "+e[5].online.MPKIT_URL.replace("https://",""):""))&&(document.title=t),C&1&&Fe(o,e[0].type),re!==(re=be(e))&&(J.d(1),J=re(e),J&&(J.c(),J.m(z,null))),C&87){X=Je(e[1].results);let T;for(T=0;T<X.length;T+=1){const Ee=Ve(e,X,T);D[T]?(D[T].p(Ee,C),F(D[T],1)):(D[T]=ze(Ee),D[T].c(),F(D[T],1),D[T].m(N,null))}for(Xe(),T=X.length;T<D.length;T+=1)Ye(T);We()}const O={};C&2&&(O.max=e[1].total_pages),!j&&C&1&&(j=!0,O.value=e[0].page,at(()=>j=!1)),R.$set(O),(!U||C&2)&&y!==(y=(e[1].total_pages||1)+"")&&ye(Q,y),B&&B.p&&(!U||C&128)&&nt(B,Te,e,e[7],U?lt(Te,e[7],C,null):st(e[7]),null)},i(m){if(!U){for(let C=0;C<X.length;C+=1)F(D[C]);F(R.$$.fragment,m),F(B,m),U=!0}},o(m){D=D.filter(Boolean);for(let C=0;C<D.length;C+=1)G(D[C]);G(R.$$.fragment,m),G(B,m),U=!1},d(m){m&&(u(a),u(n)),e[10](null),J.d(),rt(D,m),ge(R),B&&B.d(m),de=!1,Qe(le)}}}function Dt(e,t,a){let n,s;qe(e,dt,v=>a(4,n=v)),qe(e,$e,v=>a(5,s=v));let{$$slots:i={},$$scope:_}=t,h={results:[]},r={id:null},p={page:1,type:"SCHEDULED",...Object.fromEntries(n.url.searchParams)},g,o;const b=async()=>{clearInterval(o),a(1,h=await Re.get(p)),console.log(h),o=setInterval(()=>{h.results.forEach(v=>{p.type==="DEAD"?v.dead_at_parsed=ve(new Date(v.dead_at)):v.run_at_parsed=ve(new Date(v.run_at))})},1e3)};ot(()=>{clearInterval(o)});function P(){p.type=it(this),a(0,p)}function $(v){Ce[v?"unshift":"push"](()=>{g=v,a(3,g)})}const ne=v=>a(2,r.id=v.id,r),A=()=>a(2,r.id=null,r);function N(v){e.$$.not_equal(p.page,v)&&(p.page=v,a(0,p))}return e.$$set=v=>{"$$scope"in v&&a(7,_=v.$$scope)},e.$$.update=()=>{e.$$.dirty&1&&p&&b()},[p,h,r,g,n,s,b,_,i,P,$,ne,A,N]}class jt extends Ne{constructor(t){super(),Pe(this,t,Dt,$t,Le,{})}}export{jt as component};
