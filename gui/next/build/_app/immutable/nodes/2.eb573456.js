import{S as Ie,i as Le,s as Se,k as d,a as A,y as ve,q as N,l as _,m as h,c as R,z as ge,r as U,h as i,n as u,b as X,E as r,A as ye,H as oe,g as V,d as W,B as be,V as Ye,w as Ae,Q as tt,W as at,L as st,X as qe,Y as ze,f as Ze,Z as Ke,u as me,R as lt,T as rt,U as nt,_ as ot,I as xe,F as it,$ as ut,G as Je,v as et,a0 as Ge,a1 as ct}from"../chunks/index.d0f8a730.js";import"../chunks/singletons.575cc485.js";import{p as ft}from"../chunks/stores.9f047a3a.js";import{b as Ne}from"../chunks/backgroundJob.d6a5759b.js";import{I as Re}from"../chunks/Icon.82efe8b3.js";import{s as $e}from"../chunks/state.6b8c5de4.js";const he=e=>{const t=e instanceof Date?e:new Date(e),a=new Intl.RelativeTimeFormat("en"),s={years:3600*24*365,months:3600*24*30,weeks:3600*24*7,days:3600*24,hours:3600,minutes:60,seconds:1},l=(t.getTime()-Date.now())/1e3;for(let n in s)if(s[n]<Math.abs(l)){const m=l/s[n];return a.format(Math.round(m),n)}};function dt(e){let t,a,s,l,n,m,v,o,b;return n=new Re({props:{icon:"refresh",size:"22"}}),{c(){t=d("form"),a=d("input"),s=A(),l=d("button"),ve(n.$$.fragment),m=N(`
    Retry`),this.h()},l(c){t=_(c,"FORM",{});var f=h(t);a=_(f,"INPUT",{type:!0,name:!0}),s=R(f),l=_(f,"BUTTON",{class:!0});var w=h(l);ge(n.$$.fragment,w),m=U(w,`
    Retry`),w.forEach(i),f.forEach(i),this.h()},h(){u(a,"type","hidden"),u(a,"name","id"),a.value=e[0],u(l,"class","danger")},m(c,f){X(c,t,f),r(t,a),r(t,s),r(t,l),ye(n,l,null),r(l,m),e[3](t),v=!0,o||(b=oe(t,"submit",e[2]),o=!0)},p(c,[f]){(!v||f&1)&&(a.value=c[0])},i(c){v||(V(n.$$.fragment,c),v=!0)},o(c){W(n.$$.fragment,c),v=!1},d(c){c&&i(t),be(n),e[3](null),o=!1,b()}}}function _t(e,t,a){let{id:s}=t,l;const n=Ye(),m=async o=>{o.preventDefault();const b=await Ne.retry({properties:new FormData(l)});b.errors?$e.notification.create("error",`Background job ${b.admin_background_job_retry.id} could not be run again`):(n("itemsChanged"),$e.notification.create("success",`Background job ${b.admin_background_job_retry.id} planned to run again`))};function v(o){Ae[o?"unshift":"push"](()=>{l=o,a(1,l)})}return e.$$set=o=>{"id"in o&&a(0,s=o.id)},[s,l,m,v]}class mt extends Ie{constructor(t){super(),Le(this,t,_t,dt,Se,{id:0})}}function ht(e){let t,a,s,l,n,m,v,o,b,c;return m=new Re({props:{icon:"x",size:"22"}}),{c(){t=d("form"),a=d("input"),s=A(),l=d("button"),n=d("i"),ve(m.$$.fragment),v=N(`\r
    Delete background job`),this.h()},l(f){t=_(f,"FORM",{});var w=h(t);a=_(w,"INPUT",{type:!0,name:!0}),s=R(w),l=_(w,"BUTTON",{class:!0});var I=h(l);n=_(I,"I",{class:!0});var P=h(n);ge(m.$$.fragment,P),P.forEach(i),v=U(I,`\r
    Delete background job`),I.forEach(i),w.forEach(i),this.h()},h(){u(a,"type","hidden"),u(a,"name","id"),a.value=e[0],u(n,"class","svelte-ooaugn"),u(l,"class","danger")},m(f,w){X(f,t,w),r(t,a),r(t,s),r(t,l),r(l,n),ye(m,n,null),r(l,v),e[3](t),o=!0,b||(c=oe(t,"submit",e[2]),b=!0)},p(f,[w]){(!o||w&1)&&(a.value=f[0])},i(f){o||(V(m.$$.fragment,f),o=!0)},o(f){W(m.$$.fragment,f),o=!1},d(f){f&&i(t),be(m),e[3](null),b=!1,c()}}}function pt(e,t,a){let{id:s}=t,l;const n=Ye(),m=async o=>{if(o.preventDefault(),confirm("Are you sure you want to delete this background job?")){const b=await Ne.delete({properties:new FormData(l)});b.errors?$e.notification.create("error",`Background job ${b.admin_background_job_delete.id} could not be deleted`):(n("itemsChanged"),$e.notification.create("success",`Background job ${b.admin_background_job_delete.id} deleted`))}};function v(o){Ae[o?"unshift":"push"](()=>{l=o,a(1,l)})}return e.$$set=o=>{"id"in o&&a(0,s=o.id)},[s,l,m,v]}class vt extends Ie{constructor(t){super(),Le(this,t,pt,ht,Se,{id:0})}}function Qe(e,t,a){const s=e.slice();return s[15]=t[a],s}function gt(e){let t;return{c(){t=N("Runs")},l(a){t=U(a,"Runs")},m(a,s){X(a,t,s)},d(a){a&&i(t)}}}function yt(e){let t;return{c(){t=N("Failed")},l(a){t=U(a,"Failed")},m(a,s){X(a,t,s)},d(a){a&&i(t)}}}function We(e){let t,a,s;return a=new mt({props:{id:e[15].id}}),a.$on("itemsChanged",e[5]),{c(){t=d("li"),ve(a.$$.fragment),this.h()},l(l){t=_(l,"LI",{class:!0});var n=h(t);ge(a.$$.fragment,n),n.forEach(i),this.h()},h(){u(t,"class","svelte-hyom4y")},m(l,n){X(l,t,n),ye(a,t,null),s=!0},p(l,n){const m={};n&2&&(m.id=l[15].id),a.$set(m)},i(l){s||(V(a.$$.fragment,l),s=!0)},o(l){W(a.$$.fragment,l),s=!1},d(l){l&&i(t),be(a)}}}function bt(e){let t=(e[15].run_at_parsed||he(new Date(e[15].run_at)))+"",a;return{c(){a=N(t)},l(s){a=U(s,t)},m(s,l){X(s,a,l)},p(s,l){l&2&&t!==(t=(s[15].run_at_parsed||he(new Date(s[15].run_at)))+"")&&me(a,t)},d(s){s&&i(a)}}}function Et(e){let t=(e[15].dead_at_parsed||he(new Date(e[15].dead_at))||"")+"",a;return{c(){a=N(t)},l(s){a=U(s,t)},m(s,l){X(s,a,l)},p(s,l){l&2&&t!==(t=(s[15].dead_at_parsed||he(new Date(s[15].dead_at))||"")+"")&&me(a,t)},d(s){s&&i(a)}}}function Xe(e){let t,a,s,l,n,m,v,o,b,c,f,w,I,P,Y,L,y=(e[15].source_name||e[15].id)+"",B,q,ie,G,M=e[15].arguments.priority+"",ae,ue,C,Z=e[15].arguments.context.location.href+"",se,z,J,ce,S,fe,j;o=new Re({props:{icon:"navigationMenuVertical",size:"16"}});function de(){return e[10](e[15])}let k=e[15].dead_at&&We(e);P=new vt({props:{id:e[15].id}}),P.$on("itemsChanged",e[5]);function le($,E){return $[0].type==="DEAD"?Et:bt}let K=le(e),O=K(e);return{c(){t=d("tr"),a=d("td"),s=d("div"),l=d("button"),n=d("span"),m=N("More options"),v=A(),ve(o.$$.fragment),b=A(),c=d("menu"),f=d("ul"),k&&k.c(),w=A(),I=d("li"),ve(P.$$.fragment),Y=A(),L=d("a"),B=N(y),ie=A(),G=d("td"),ae=N(M),ue=A(),C=d("td"),se=N(Z),z=A(),J=d("td"),O.c(),ce=A(),this.h()},l($){t=_($,"TR",{class:!0});var E=h(t);a=_(E,"TD",{class:!0});var re=h(a);s=_(re,"DIV",{class:!0});var x=h(s);l=_(x,"BUTTON",{class:!0});var ee=h(l);n=_(ee,"SPAN",{class:!0});var H=h(n);m=U(H,"More options"),H.forEach(i),v=R(ee),ge(o.$$.fragment,ee),ee.forEach(i),b=R(x),c=_(x,"MENU",{class:!0});var Q=h(c);f=_(Q,"UL",{});var g=h(f);k&&k.l(g),w=R(g),I=_(g,"LI",{class:!0});var Ee=h(I);ge(P.$$.fragment,Ee),Ee.forEach(i),g.forEach(i),Q.forEach(i),Y=R(x),L=_(x,"A",{href:!0,class:!0});var _e=h(L);B=U(_e,y),_e.forEach(i),x.forEach(i),re.forEach(i),ie=R(E),G=_(E,"TD",{class:!0});var F=h(G);ae=U(F,M),F.forEach(i),ue=R(E),C=_(E,"TD",{class:!0});var p=h(C);se=U(p,Z),p.forEach(i),z=R(E),J=_(E,"TD",{class:!0});var T=h(J);O.l(T),T.forEach(i),ce=R(E),E.forEach(i),this.h()},h(){u(n,"class","label"),u(l,"class","button compact more svelte-hyom4y"),u(I,"class","svelte-hyom4y"),u(c,"class","content-context svelte-hyom4y"),Je(c,"active",e[2].id===e[15].id),u(L,"href",q="/backgroundJobs/"+e[0].type.toLowerCase()+"/"+e[15].id+"?"+e[4].url.searchParams.toString()),u(L,"class","svelte-hyom4y"),u(s,"class","svelte-hyom4y"),u(a,"class","id svelte-hyom4y"),u(G,"class","svelte-hyom4y"),u(C,"class","svelte-hyom4y"),u(J,"class","svelte-hyom4y"),u(t,"class","svelte-hyom4y")},m($,E){X($,t,E),r(t,a),r(a,s),r(s,l),r(l,n),r(n,m),r(l,v),ye(o,l,null),r(s,b),r(s,c),r(c,f),k&&k.m(f,null),r(f,w),r(f,I),ye(P,I,null),r(s,Y),r(s,L),r(L,B),r(t,ie),r(t,G),r(G,ae),r(t,ue),r(t,C),r(C,se),r(t,z),r(t,J),O.m(J,null),r(t,ce),S=!0,fe||(j=[oe(l,"click",de),oe(a,"mouseleave",e[11])],fe=!0)},p($,E){e=$,e[15].dead_at?k?(k.p(e,E),E&2&&V(k,1)):(k=We(e),k.c(),V(k,1),k.m(f,w)):k&&(et(),W(k,1,1,()=>{k=null}),Ze());const re={};E&2&&(re.id=e[15].id),P.$set(re),(!S||E&6)&&Je(c,"active",e[2].id===e[15].id),(!S||E&2)&&y!==(y=(e[15].source_name||e[15].id)+"")&&me(B,y),(!S||E&19&&q!==(q="/backgroundJobs/"+e[0].type.toLowerCase()+"/"+e[15].id+"?"+e[4].url.searchParams.toString()))&&u(L,"href",q),(!S||E&2)&&M!==(M=e[15].arguments.priority+"")&&me(ae,M),(!S||E&2)&&Z!==(Z=e[15].arguments.context.location.href+"")&&me(se,Z),K===(K=le(e))&&O?O.p(e,E):(O.d(1),O=K(e),O&&(O.c(),O.m(J,null)))},i($){S||(V(o.$$.fragment,$),V(k),V(P.$$.fragment,$),S=!0)},o($){W(o.$$.fragment,$),W(k),W(P.$$.fragment,$),S=!1},d($){$&&i(t),be(o),k&&k.d(),be(P),O.d(),fe=!1,xe(j)}}}function Dt(e){let t,a,s,l,n,m,v,o,b,c,f,w,I,P,Y,L,y,B,q,ie,G,M,ae,ue,C,Z,se,z,J,ce,S,fe,j,de,k,le=(e[1].total_pages||"")+"",K,O,$,E,re;function x(p,T){return p[0].type==="DEAD"?yt:gt}let ee=x(e),H=ee(e),Q=e[1].results,g=[];for(let p=0;p<Q.length;p+=1)g[p]=Xe(Qe(e,Q,p));const Ee=p=>W(g[p],1,1,()=>{g[p]=null}),_e=e[7].default,F=tt(_e,e,e[6],null);return{c(){t=A(),a=d("div"),s=d("div"),l=d("nav"),n=d("form"),m=d("fieldset"),v=d("label"),o=N("Type:"),b=A(),c=d("select"),f=d("option"),w=N("Scheduled"),I=d("option"),P=N("Failed"),Y=A(),L=d("table"),y=d("thead"),B=d("tr"),q=d("th"),ie=N("Name / id"),G=A(),M=d("th"),ae=N("Priority"),ue=A(),C=d("th"),Z=N("URL"),se=A(),z=d("th"),H.c(),J=A();for(let p=0;p<g.length;p+=1)g[p].c();ce=A(),S=d("nav"),fe=N(`Page:
      `),j=d("input"),k=N(`
      of `),K=N(le),O=A(),F&&F.c(),this.h()},l(p){at("svelte-16df4tm",document.head).forEach(i),t=R(p),a=_(p,"DIV",{class:!0});var D=h(a);s=_(D,"DIV",{class:!0});var te=h(s);l=_(te,"NAV",{class:!0});var Ue=h(l);n=_(Ue,"FORM",{id:!0,class:!0});var Pe=h(n);m=_(Pe,"FIELDSET",{class:!0});var De=h(m);v=_(De,"LABEL",{for:!0});var je=h(v);o=U(je,"Type:"),je.forEach(i),b=R(De),c=_(De,"SELECT",{name:!0,id:!0});var Te=h(c);f=_(Te,"OPTION",{});var Be=h(f);w=U(Be,"Scheduled"),Be.forEach(i),I=_(Te,"OPTION",{});var Fe=h(I);P=U(Fe,"Failed"),Fe.forEach(i),Te.forEach(i),De.forEach(i),Pe.forEach(i),Ue.forEach(i),Y=R(te),L=_(te,"TABLE",{class:!0});var ke=h(L);y=_(ke,"THEAD",{class:!0});var Oe=h(y);B=_(Oe,"TR",{});var ne=h(B);q=_(ne,"TH",{class:!0});var Ce=h(q);ie=U(Ce,"Name / id"),Ce.forEach(i),G=R(ne),M=_(ne,"TH",{class:!0});var Me=h(M);ae=U(Me,"Priority"),Me.forEach(i),ue=R(ne),C=_(ne,"TH",{class:!0});var He=h(C);Z=U(He,"URL"),He.forEach(i),se=R(ne),z=_(ne,"TH",{class:!0});var Ve=h(z);H.l(Ve),Ve.forEach(i),ne.forEach(i),Oe.forEach(i),J=R(ke);for(let we=0;we<g.length;we+=1)g[we].l(ke);ke.forEach(i),ce=R(te),S=_(te,"NAV",{class:!0});var pe=h(S);fe=U(pe,`Page:
      `),j=_(pe,"INPUT",{type:!0,name:!0,min:!0,max:!0,step:!0,form:!0}),k=U(pe,`
      of `),K=U(pe,le),pe.forEach(i),te.forEach(i),O=R(D),F&&F.l(D),D.forEach(i),this.h()},h(){document.title="Background Jobs | platformOS",u(v,"for","filter-type"),f.__value="SCHEDULED",f.value=f.__value,I.__value="DEAD",I.value=I.__value,u(c,"name","type"),u(c,"id","filter-type"),e[0].type===void 0&&st(()=>e[8].call(c)),u(m,"class","svelte-hyom4y"),u(n,"id","filters"),u(n,"class","svelte-hyom4y"),u(l,"class","filters svelte-hyom4y"),u(q,"class","id svelte-hyom4y"),u(M,"class","svelte-hyom4y"),u(C,"class","svelte-hyom4y"),u(z,"class","svelte-hyom4y"),u(y,"class","svelte-hyom4y"),u(L,"class","svelte-hyom4y"),u(j,"type","number"),u(j,"name","page"),u(j,"min","1"),u(j,"max",de=e[1].total_pages||100),u(j,"step","1"),u(j,"form","filters"),u(S,"class","pagination svelte-hyom4y"),u(s,"class","svelte-hyom4y"),u(a,"class","container svelte-hyom4y")},m(p,T){X(p,t,T),X(p,a,T),r(a,s),r(s,l),r(l,n),r(n,m),r(m,v),r(v,o),r(m,b),r(m,c),r(c,f),r(f,w),r(c,I),r(I,P),qe(c,e[0].type,!0),e[9](n),r(s,Y),r(s,L),r(L,y),r(y,B),r(B,q),r(q,ie),r(B,G),r(B,M),r(M,ae),r(B,ue),r(B,C),r(C,Z),r(B,se),r(B,z),H.m(z,null),r(L,J);for(let D=0;D<g.length;D+=1)g[D]&&g[D].m(L,null);r(s,ce),r(s,S),r(S,fe),r(S,j),ze(j,e[0].page),r(S,k),r(S,K),r(a,O),F&&F.m(a,null),$=!0,E||(re=[oe(c,"change",e[8]),oe(c,"change",function(){Ge(e[3].requestSubmit())&&e[3].requestSubmit().apply(this,arguments)}),oe(j,"input",e[12]),oe(j,"change",function(){Ge(e[3].requestSubmit())&&e[3].requestSubmit().apply(this,arguments)})],E=!0)},p(p,[T]){if(e=p,T&1&&qe(c,e[0].type),ee!==(ee=x(e))&&(H.d(1),H=ee(e),H&&(H.c(),H.m(z,null))),T&55){Q=e[1].results;let D;for(D=0;D<Q.length;D+=1){const te=Qe(e,Q,D);g[D]?(g[D].p(te,T),V(g[D],1)):(g[D]=Xe(te),g[D].c(),V(g[D],1),g[D].m(L,null))}for(et(),D=Q.length;D<g.length;D+=1)Ee(D);Ze()}(!$||T&2&&de!==(de=e[1].total_pages||100))&&u(j,"max",de),T&1&&Ke(j.value)!==e[0].page&&ze(j,e[0].page),(!$||T&2)&&le!==(le=(e[1].total_pages||"")+"")&&me(K,le),F&&F.p&&(!$||T&64)&&lt(F,_e,e,e[6],$?nt(_e,e[6],T,null):rt(e[6]),null)},i(p){if(!$){for(let T=0;T<Q.length;T+=1)V(g[T]);V(F,p),$=!0}},o(p){g=g.filter(Boolean);for(let T=0;T<g.length;T+=1)W(g[T]);W(F,p),$=!1},d(p){p&&i(t),p&&i(a),e[9](null),H.d(),ot(g,p),F&&F.d(p),E=!1,xe(re)}}}function kt(e,t,a){let s;it(e,ft,y=>a(4,s=y));let{$$slots:l={},$$scope:n}=t,m={results:[]},v={id:null},o={page:1,type:"SCHEDULED",...Object.fromEntries(s.url.searchParams)},b,c;const f=async()=>{clearInterval(c),a(1,m=await Ne.get(o)),c=setInterval(()=>{m.results.forEach(y=>{o.type==="DEAD"?y.dead_at_parsed=he(new Date(y.dead_at)):y.run_at_parsed=he(new Date(y.run_at))})},1e3)};ut(()=>{clearInterval(c)});function w(){o.type=ct(this),a(0,o)}function I(y){Ae[y?"unshift":"push"](()=>{b=y,a(3,b)})}const P=y=>a(2,v.id=y.id,v),Y=()=>a(2,v.id=null,v);function L(){o.page=Ke(this.value),a(0,o)}return e.$$set=y=>{"$$scope"in y&&a(6,n=y.$$scope)},e.$$.update=()=>{e.$$.dirty&1&&o&&f()},[o,m,v,b,s,f,n,l,w,I,P,Y,L]}class At extends Ie{constructor(t){super(),Le(this,t,kt,Dt,Se,{})}}export{At as component};
