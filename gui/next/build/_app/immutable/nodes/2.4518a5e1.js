import{S as Ee,i as ye,s as De,k as m,a as I,y as me,q as S,l as p,m as v,c as L,z as pe,r as U,h as i,n as g,b as W,F as l,A as ve,G as oe,g as C,d as Q,B as ge,V as Oe,w as $e,Q as Pe,W as He,L as Ve,X as Se,f as Fe,R as qe,T as Je,U as Ge,Y as Qe,H as Ce,I as We,Z as Xe,E as Ue,v as Me,u as he,_ as Ye,$ as Ze}from"../chunks/index.9dbfcd7f.js";import"../chunks/singletons.9e337012.js";import{p as Ke}from"../chunks/stores.dd05afbf.js";import{b as Te}from"../chunks/backgroundJob.ed602863.js";import{I as we}from"../chunks/Icon.db4f4e9b.js";import{s as be}from"../chunks/state.4ed96939.js";const ie=e=>{const t=e instanceof Date?e:new Date(e),a=new Intl.RelativeTimeFormat("en"),s={years:3600*24*365,months:3600*24*30,weeks:3600*24*7,days:3600*24,hours:3600,minutes:60,seconds:1},r=(t.getTime()-Date.now())/1e3;for(let n in s)if(s[n]<Math.abs(r)){const h=r/s[n];return a.format(Math.round(h),n)}};function xe(e){let t,a,s,r,n,h,$,o,u;return n=new we({props:{icon:"refresh",size:"22"}}),{c(){t=m("form"),a=m("input"),s=I(),r=m("button"),me(n.$$.fragment),h=S(`
    Retry`),this.h()},l(c){t=p(c,"FORM",{});var d=v(t);a=p(d,"INPUT",{type:!0,name:!0}),s=L(d),r=p(d,"BUTTON",{class:!0});var D=v(r);pe(n.$$.fragment,D),h=U(D,`
    Retry`),D.forEach(i),d.forEach(i),this.h()},h(){g(a,"type","hidden"),g(a,"name","id"),a.value=e[0],g(r,"class","danger")},m(c,d){W(c,t,d),l(t,a),l(t,s),l(t,r),ve(n,r,null),l(r,h),e[3](t),$=!0,o||(u=oe(t,"submit",e[2]),o=!0)},p(c,[d]){(!$||d&1)&&(a.value=c[0])},i(c){$||(C(n.$$.fragment,c),$=!0)},o(c){Q(n.$$.fragment,c),$=!1},d(c){c&&i(t),ge(n),e[3](null),o=!1,u()}}}function et(e,t,a){let{id:s}=t,r;const n=Oe(),h=async o=>{o.preventDefault();const u=await Te.retry({properties:new FormData(r)});u.errors?be.notification.create("error",`Background job ${u.admin_background_job_retry.id} could not be run again`):(n("itemsChanged"),be.notification.create("success",`Background job ${u.admin_background_job_retry.id} planned to run again`))};function $(o){$e[o?"unshift":"push"](()=>{r=o,a(1,r)})}return e.$$set=o=>{"id"in o&&a(0,s=o.id)},[s,r,h,$]}class tt extends Ee{constructor(t){super(),ye(this,t,et,xe,De,{id:0})}}function at(e){let t,a,s,r,n,h,$,o,u,c;return h=new we({props:{icon:"x",size:"22"}}),{c(){t=m("form"),a=m("input"),s=I(),r=m("button"),n=m("i"),me(h.$$.fragment),$=S(`\r
    Delete background job`),this.h()},l(d){t=p(d,"FORM",{});var D=v(t);a=p(D,"INPUT",{type:!0,name:!0}),s=L(D),r=p(D,"BUTTON",{class:!0});var A=v(r);n=p(A,"I",{class:!0});var z=v(n);pe(h.$$.fragment,z),z.forEach(i),$=U(A,`\r
    Delete background job`),A.forEach(i),D.forEach(i),this.h()},h(){g(a,"type","hidden"),g(a,"name","id"),a.value=e[0],g(n,"class","svelte-ooaugn"),g(r,"class","danger")},m(d,D){W(d,t,D),l(t,a),l(t,s),l(t,r),l(r,n),ve(h,n,null),l(r,$),e[3](t),o=!0,u||(c=oe(t,"submit",e[2]),u=!0)},p(d,[D]){(!o||D&1)&&(a.value=d[0])},i(d){o||(C(h.$$.fragment,d),o=!0)},o(d){Q(h.$$.fragment,d),o=!1},d(d){d&&i(t),ge(h),e[3](null),u=!1,c()}}}function st(e,t,a){let{id:s}=t,r;const n=Oe(),h=async o=>{if(o.preventDefault(),confirm("Are you sure you want to delete this background job?")){const u=await Te.delete({properties:new FormData(r)});u.errors?be.notification.create("error",`Background job ${u.admin_background_job_delete.id} could not be deleted`):(n("itemsChanged"),be.notification.create("success",`Background job ${u.admin_background_job_delete.id} deleted`))}};function $(o){$e[o?"unshift":"push"](()=>{r=o,a(1,r)})}return e.$$set=o=>{"id"in o&&a(0,s=o.id)},[s,r,h,$]}class rt extends Ee{constructor(t){super(),ye(this,t,st,at,De,{id:0})}}function je(e,t,a){const s=e.slice();return s[14]=t[a],s}function lt(e){let t;return{c(){t=S("Runs")},l(a){t=U(a,"Runs")},m(a,s){W(a,t,s)},d(a){a&&i(t)}}}function nt(e){let t;return{c(){t=S("Failed")},l(a){t=U(a,"Failed")},m(a,s){W(a,t,s)},d(a){a&&i(t)}}}function Be(e){let t,a,s;return a=new tt({props:{id:e[14].id}}),a.$on("itemsChanged",e[5]),{c(){t=m("li"),me(a.$$.fragment),this.h()},l(r){t=p(r,"LI",{class:!0});var n=v(t);pe(a.$$.fragment,n),n.forEach(i),this.h()},h(){g(t,"class","svelte-z5d54k")},m(r,n){W(r,t,n),ve(a,t,null),s=!0},p(r,n){const h={};n&2&&(h.id=r[14].id),a.$set(h)},i(r){s||(C(a.$$.fragment,r),s=!0)},o(r){Q(a.$$.fragment,r),s=!1},d(r){r&&i(t),ge(a)}}}function ot(e){let t=(e[14].run_at_parsed||ie(new Date(e[14].run_at)))+"",a;return{c(){a=S(t)},l(s){a=U(s,t)},m(s,r){W(s,a,r)},p(s,r){r&2&&t!==(t=(s[14].run_at_parsed||ie(new Date(s[14].run_at)))+"")&&he(a,t)},d(s){s&&i(a)}}}function it(e){let t=(e[14].dead_at_parsed||ie(new Date(e[14].dead_at))||"")+"",a;return{c(){a=S(t)},l(s){a=U(s,t)},m(s,r){W(s,a,r)},p(s,r){r&2&&t!==(t=(s[14].dead_at_parsed||ie(new Date(s[14].dead_at))||"")+"")&&he(a,t)},d(s){s&&i(a)}}}function Ne(e){let t,a,s,r,n,h,$,o,u,c,d,D,A,z,j,b,R=(e[14].source_name||e[14].id)+"",M,K,te,B,X=e[14].arguments.priority+"",x,H,V,Y=e[14].arguments.context.location.href+"",F,ae,P,q,N,re,ue;o=new we({props:{icon:"navigationMenuVertical",size:"16"}});function le(){return e[10](e[14])}let k=e[14].dead_at&&Be(e);z=new rt({props:{id:e[14].id}}),z.$on("itemsChanged",e[5]);function J(w,f){return w[0].type==="DEAD"?it:ot}let y=J(e),O=y(e);return{c(){t=m("tr"),a=m("td"),s=m("div"),r=m("button"),n=m("span"),h=S("More options"),$=I(),me(o.$$.fragment),u=I(),c=m("menu"),d=m("ul"),k&&k.c(),D=I(),A=m("li"),me(z.$$.fragment),j=I(),b=m("a"),M=S(R),te=I(),B=m("td"),x=S(X),H=I(),V=m("td"),F=S(Y),ae=I(),P=m("td"),O.c(),q=I(),this.h()},l(w){t=p(w,"TR",{class:!0});var f=v(t);a=p(f,"TD",{class:!0});var _=v(a);s=p(_,"DIV",{class:!0});var T=v(s);r=p(T,"BUTTON",{class:!0});var E=v(r);n=p(E,"SPAN",{class:!0});var G=v(n);h=U(G,"More options"),G.forEach(i),$=L(E),pe(o.$$.fragment,E),E.forEach(i),u=L(T),c=p(T,"MENU",{class:!0});var ce=v(c);d=p(ce,"UL",{});var Z=v(d);k&&k.l(Z),D=L(Z),A=p(Z,"LI",{class:!0});var de=v(A);pe(z.$$.fragment,de),de.forEach(i),Z.forEach(i),ce.forEach(i),j=L(T),b=p(T,"A",{href:!0,class:!0});var ne=v(b);M=U(ne,R),ne.forEach(i),T.forEach(i),_.forEach(i),te=L(f),B=p(f,"TD",{class:!0});var fe=v(B);x=U(fe,X),fe.forEach(i),H=L(f),V=p(f,"TD",{class:!0});var _e=v(V);F=U(_e,Y),_e.forEach(i),ae=L(f),P=p(f,"TD",{class:!0});var se=v(P);O.l(se),se.forEach(i),q=L(f),f.forEach(i),this.h()},h(){g(n,"class","label"),g(r,"class","button compact more svelte-z5d54k"),g(A,"class","svelte-z5d54k"),g(c,"class","content-context svelte-z5d54k"),Ue(c,"active",e[2].id===e[14].id),g(b,"href",K="/backgroundJobs/"+e[0].type.toLowerCase()+"/"+e[14].id+"?"+e[4].url.searchParams.toString()),g(b,"class","svelte-z5d54k"),g(s,"class","svelte-z5d54k"),g(a,"class","id svelte-z5d54k"),g(B,"class","svelte-z5d54k"),g(V,"class","svelte-z5d54k"),g(P,"class","svelte-z5d54k"),g(t,"class","svelte-z5d54k")},m(w,f){W(w,t,f),l(t,a),l(a,s),l(s,r),l(r,n),l(n,h),l(r,$),ve(o,r,null),l(s,u),l(s,c),l(c,d),k&&k.m(d,null),l(d,D),l(d,A),ve(z,A,null),l(s,j),l(s,b),l(b,M),l(t,te),l(t,B),l(B,x),l(t,H),l(t,V),l(V,F),l(t,ae),l(t,P),O.m(P,null),l(t,q),N=!0,re||(ue=[oe(r,"click",le),oe(a,"mouseleave",e[11])],re=!0)},p(w,f){e=w,e[14].dead_at?k?(k.p(e,f),f&2&&C(k,1)):(k=Be(e),k.c(),C(k,1),k.m(d,D)):k&&(Me(),Q(k,1,1,()=>{k=null}),Fe());const _={};f&2&&(_.id=e[14].id),z.$set(_),(!N||f&6)&&Ue(c,"active",e[2].id===e[14].id),(!N||f&2)&&R!==(R=(e[14].source_name||e[14].id)+"")&&he(M,R),(!N||f&19&&K!==(K="/backgroundJobs/"+e[0].type.toLowerCase()+"/"+e[14].id+"?"+e[4].url.searchParams.toString()))&&g(b,"href",K),(!N||f&2)&&X!==(X=e[14].arguments.priority+"")&&he(x,X),(!N||f&2)&&Y!==(Y=e[14].arguments.context.location.href+"")&&he(F,Y),y===(y=J(e))&&O?O.p(e,f):(O.d(1),O=y(e),O&&(O.c(),O.m(P,null)))},i(w){N||(C(o.$$.fragment,w),C(k),C(z.$$.fragment,w),N=!0)},o(w){Q(o.$$.fragment,w),Q(k),Q(z.$$.fragment,w),N=!1},d(w){w&&i(t),ge(o),k&&k.d(),ge(z),O.d(),re=!1,Ce(ue)}}}function ut(e){let t,a,s,r,n,h,$,o,u,c,d,D,A,z,j,b,R,M,K,te,B,X,x,H,V,Y,F,ae,P,q,N,re;function ue(_,T){return _[0].type==="DEAD"?nt:lt}let le=ue(e),k=le(e),J=e[1],y=[];for(let _=0;_<J.length;_+=1)y[_]=Ne(je(e,J,_));const O=_=>Q(y[_],1,1,()=>{y[_]=null}),w=e[7].default,f=Pe(w,e,e[6],null);return{c(){t=I(),a=m("div"),s=m("div"),r=m("nav"),n=m("form"),h=m("label"),$=S("Type:"),o=I(),u=m("select"),c=m("option"),d=S("Scheduled"),D=m("option"),A=S("Failed"),z=I(),j=m("table"),b=m("thead"),R=m("tr"),M=m("th"),K=S("Name / id"),te=I(),B=m("th"),X=S("Priority"),x=I(),H=m("th"),V=S("URL"),Y=I(),F=m("th"),k.c(),ae=I();for(let _=0;_<y.length;_+=1)y[_].c();P=I(),f&&f.c(),this.h()},l(_){He("svelte-16df4tm",document.head).forEach(i),t=L(_),a=p(_,"DIV",{class:!0});var E=v(a);s=p(E,"DIV",{class:!0});var G=v(s);r=p(G,"NAV",{class:!0});var ce=v(r);n=p(ce,"FORM",{});var Z=v(n);h=p(Z,"LABEL",{for:!0});var de=v(h);$=U(de,"Type:"),de.forEach(i),o=L(Z),u=p(Z,"SELECT",{name:!0,id:!0});var ne=v(u);c=p(ne,"OPTION",{});var fe=v(c);d=U(fe,"Scheduled"),fe.forEach(i),D=p(ne,"OPTION",{});var _e=v(D);A=U(_e,"Failed"),_e.forEach(i),ne.forEach(i),Z.forEach(i),ce.forEach(i),z=L(G),j=p(G,"TABLE",{class:!0});var se=v(j);b=p(se,"THEAD",{class:!0});var ze=v(b);R=p(ze,"TR",{});var ee=v(R);M=p(ee,"TH",{class:!0});var Ie=v(M);K=U(Ie,"Name / id"),Ie.forEach(i),te=L(ee),B=p(ee,"TH",{class:!0});var Le=v(B);X=U(Le,"Priority"),Le.forEach(i),x=L(ee),H=p(ee,"TH",{class:!0});var Re=v(H);V=U(Re,"URL"),Re.forEach(i),Y=L(ee),F=p(ee,"TH",{class:!0});var Ae=v(F);k.l(Ae),Ae.forEach(i),ee.forEach(i),ze.forEach(i),ae=L(se);for(let ke=0;ke<y.length;ke+=1)y[ke].l(se);se.forEach(i),G.forEach(i),P=L(E),f&&f.l(E),E.forEach(i),this.h()},h(){document.title="Background Jobs | platformOS",g(h,"for","filter-type"),c.__value="SCHEDULED",c.value=c.__value,D.__value="DEAD",D.value=D.__value,g(u,"name","type"),g(u,"id","filter-type"),e[0].type===void 0&&Ve(()=>e[8].call(u)),g(r,"class","svelte-z5d54k"),g(M,"class","id svelte-z5d54k"),g(B,"class","svelte-z5d54k"),g(H,"class","svelte-z5d54k"),g(F,"class","svelte-z5d54k"),g(b,"class","svelte-z5d54k"),g(j,"class","svelte-z5d54k"),g(s,"class","svelte-z5d54k"),g(a,"class","container svelte-z5d54k")},m(_,T){W(_,t,T),W(_,a,T),l(a,s),l(s,r),l(r,n),l(n,h),l(h,$),l(n,o),l(n,u),l(u,c),l(c,d),l(u,D),l(D,A),Se(u,e[0].type,!0),e[9](n),l(s,z),l(s,j),l(j,b),l(b,R),l(R,M),l(M,K),l(R,te),l(R,B),l(B,X),l(R,x),l(R,H),l(H,V),l(R,Y),l(R,F),k.m(F,null),l(j,ae);for(let E=0;E<y.length;E+=1)y[E]&&y[E].m(j,null);l(a,P),f&&f.m(a,null),q=!0,N||(re=[oe(u,"change",e[8]),oe(u,"change",function(){Ye(e[3].requestSubmit())&&e[3].requestSubmit().apply(this,arguments)})],N=!0)},p(_,[T]){if(e=_,T&1&&Se(u,e[0].type),le!==(le=ue(e))&&(k.d(1),k=le(e),k&&(k.c(),k.m(F,null))),T&55){J=e[1];let E;for(E=0;E<J.length;E+=1){const G=je(e,J,E);y[E]?(y[E].p(G,T),C(y[E],1)):(y[E]=Ne(G),y[E].c(),C(y[E],1),y[E].m(j,null))}for(Me(),E=J.length;E<y.length;E+=1)O(E);Fe()}f&&f.p&&(!q||T&64)&&qe(f,w,e,e[6],q?Ge(w,e[6],T,null):Je(e[6]),null)},i(_){if(!q){for(let T=0;T<J.length;T+=1)C(y[T]);C(f,_),q=!0}},o(_){y=y.filter(Boolean);for(let T=0;T<y.length;T+=1)Q(y[T]);Q(f,_),q=!1},d(_){_&&i(t),_&&i(a),e[9](null),k.d(),Qe(y,_),f&&f.d(_),N=!1,Ce(re)}}}function ct(e,t,a){let s;We(e,Ke,b=>a(4,s=b));let{$$slots:r={},$$scope:n}=t,h=[],$={id:null},o={type:"SCHEDULED",...Object.fromEntries(s.url.searchParams)},u,c;const d=async()=>{clearInterval(c),a(1,h=await Te.get(o)),c=setInterval(()=>{h.forEach(b=>{o.type==="DEAD"?b.dead_at_parsed=ie(new Date(b.dead_at)):b.run_at_parsed=ie(new Date(b.run_at))})},1e3)};Xe(()=>{clearInterval(c)});function D(){o.type=Ze(this),a(0,o)}function A(b){$e[b?"unshift":"push"](()=>{u=b,a(3,u)})}const z=b=>a(2,$.id=b.id,$),j=()=>a(2,$.id=null,$);return e.$$set=b=>{"$$scope"in b&&a(6,n=b.$$scope)},e.$$.update=()=>{e.$$.dirty&1&&o&&d()},[o,h,$,u,s,d,n,r,D,A,z,j]}class vt extends Ee{constructor(t){super(),ye(this,t,ct,ut,De,{})}}export{vt as component};
