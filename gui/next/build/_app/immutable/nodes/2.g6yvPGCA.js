import{s as Ae,e as d,a as L,t as Q,c as f,b as y,g as N,d as W,f as u,y as c,i as X,h as l,B as me,R as Xe,G as Le,F as He,l as nt,p as at,z as ne,A as Pe,K as st,L as Ve,M as lt,j as De,u as rt,m as ot,o as it,D as ut,r as Ye,k as ze,_ as dt,E as Je,N as ft}from"../chunks/scheduler.CatAnzbk.js";import{S as Ue,i as je,c as pe,b as he,m as ge,t as F,a as z,e as ve,f as ct,d as Ze,g as xe}from"../chunks/index.N6gnbVk9.js";import{e as Ke}from"../chunks/each.S7kOhTNK.js";import"../chunks/entry.ZT0uIwT5.js";import{p as _t}from"../chunks/stores.1wDFbM4f.js";import{b as Me}from"../chunks/backgroundJob.6WsQLD6d.js";import{s as Ce}from"../chunks/state.5gKcL4gY.js";import{I as Se}from"../chunks/Icon.Y-cxXlAi.js";import{N as mt}from"../chunks/Number.rm8CIWFS.js";const be=e=>{const t=e instanceof Date?e:new Date(e),n=new Intl.RelativeTimeFormat("en"),a={years:3600*24*365,months:3600*24*30,weeks:3600*24*7,days:3600*24,hours:3600,minutes:60,seconds:1},s=(t.getTime()-Date.now())/1e3;for(let i in a)if(a[i]<Math.abs(s)){const _=s/a[i];return n.format(Math.round(_),i)}};function pt(e){let t,n,a,s,i,_,v,o,p;return i=new Se({props:{icon:"refresh",size:"22"}}),{c(){t=d("form"),n=d("input"),a=L(),s=d("button"),pe(i.$$.fragment),_=Q(`\r
    Retry`),this.h()},l(h){t=f(h,"FORM",{});var r=y(t);n=f(r,"INPUT",{type:!0,name:!0}),a=N(r),s=f(r,"BUTTON",{class:!0});var b=y(s);he(i.$$.fragment,b),_=W(b,`\r
    Retry`),b.forEach(u),r.forEach(u),this.h()},h(){c(n,"type","hidden"),c(n,"name","id"),n.value=e[0],c(s,"class","danger")},m(h,r){X(h,t,r),l(t,n),l(t,a),l(t,s),ge(i,s,null),l(s,_),e[3](t),v=!0,o||(p=me(t,"submit",e[2]),o=!0)},p(h,[r]){(!v||r&1)&&(n.value=h[0])},i(h){v||(F(i.$$.fragment,h),v=!0)},o(h){z(i.$$.fragment,h),v=!1},d(h){h&&u(t),ve(i),e[3](null),o=!1,p()}}}function ht(e,t,n){let{id:a}=t,s;const i=Xe(),_=async o=>{o.preventDefault();const p=await Me.retry({properties:new FormData(s)});p.errors?Ce.notification.create("error",`Background job ${p.admin_background_job_retry.id} could not be run again`):(i("itemsChanged"),Ce.notification.create("success",`Background job ${p.admin_background_job_retry.id} planned to run again`))};function v(o){Le[o?"unshift":"push"](()=>{s=o,n(1,s)})}return e.$$set=o=>{"id"in o&&n(0,a=o.id)},[a,s,_,v]}class gt extends Ue{constructor(t){super(),je(this,t,ht,pt,Ae,{id:0})}}function vt(e){let t,n,a,s,i,_,v,o,p,h;return _=new Se({props:{icon:"x",size:"22"}}),{c(){t=d("form"),n=d("input"),a=L(),s=d("button"),i=d("i"),pe(_.$$.fragment),v=Q(`\r
    Delete background job`),this.h()},l(r){t=f(r,"FORM",{});var b=y(t);n=f(b,"INPUT",{type:!0,name:!0}),a=N(b),s=f(b,"BUTTON",{class:!0});var P=y(s);i=f(P,"I",{class:!0});var k=y(i);he(_.$$.fragment,k),k.forEach(u),v=W(P,`\r
    Delete background job`),P.forEach(u),b.forEach(u),this.h()},h(){c(n,"type","hidden"),c(n,"name","id"),n.value=e[0],c(i,"class","svelte-ooaugn"),c(s,"class","danger")},m(r,b){X(r,t,b),l(t,n),l(t,a),l(t,s),l(s,i),ge(_,i,null),l(s,v),e[3](t),o=!0,p||(h=me(t,"submit",e[2]),p=!0)},p(r,[b]){(!o||b&1)&&(n.value=r[0])},i(r){o||(F(_.$$.fragment,r),o=!0)},o(r){z(_.$$.fragment,r),o=!1},d(r){r&&u(t),ve(_),e[3](null),p=!1,h()}}}function bt(e,t,n){let{id:a}=t,s;const i=Xe(),_=async o=>{if(o.preventDefault(),confirm("Are you sure you want to delete this background job?")){const p=await Me.delete({properties:new FormData(s)});p.errors?Ce.notification.create("error",`Background job ${p.admin_background_job_delete.id} could not be deleted`):(i("itemsChanged"),Ce.notification.create("success",`Background job ${p.admin_background_job_delete.id} deleted`))}};function v(o){Le[o?"unshift":"push"](()=>{s=o,n(1,s)})}return e.$$set=o=>{"id"in o&&n(0,a=o.id)},[a,s,_,v]}class Et extends Ue{constructor(t){super(),je(this,t,bt,vt,Ae,{id:0})}}function Ge(e,t,n){const a=e.slice();return a[16]=t[n],a}function yt(e){let t;return{c(){t=Q("Runs")},l(n){t=W(n,"Runs")},m(n,a){X(n,t,a)},d(n){n&&u(t)}}}function $t(e){let t;return{c(){t=Q("Failed")},l(n){t=W(n,"Failed")},m(n,a){X(n,t,a)},d(n){n&&u(t)}}}function Qe(e){let t,n,a;return n=new gt({props:{id:e[16].id}}),n.$on("itemsChanged",e[6]),{c(){t=d("li"),pe(n.$$.fragment),this.h()},l(s){t=f(s,"LI",{class:!0});var i=y(t);he(n.$$.fragment,i),i.forEach(u),this.h()},h(){c(t,"class","svelte-1m1ug4d")},m(s,i){X(s,t,i),ge(n,t,null),a=!0},p(s,i){const _={};i&2&&(_.id=s[16].id),n.$set(_)},i(s){a||(F(n.$$.fragment,s),a=!0)},o(s){z(n.$$.fragment,s),a=!1},d(s){s&&u(t),ve(n)}}}function kt(e){let t=(e[16].run_at_parsed||be(new Date(e[16].run_at)))+"",n;return{c(){n=Q(t)},l(a){n=W(a,t)},m(a,s){X(a,n,s)},p(a,s){s&2&&t!==(t=(a[16].run_at_parsed||be(new Date(a[16].run_at)))+"")&&De(n,t)},d(a){a&&u(n)}}}function Dt(e){let t=(e[16].dead_at_parsed||be(new Date(e[16].dead_at))||"")+"",n;return{c(){n=Q(t)},l(a){n=W(a,t)},m(a,s){X(a,n,s)},p(a,s){s&2&&t!==(t=(a[16].dead_at_parsed||be(new Date(a[16].dead_at))||"")+"")&&De(n,t)},d(a){a&&u(n)}}}function We(e){let t,n,a,s,i,_="More options",v,o,p,h,r,b,P,k,te,w,J=(e[16].source_name||e[16].id)+"",E,j,K,R,M=e[16].queue+"",ae,se,A,ie,q,V,ue;o=new Se({props:{icon:"navigationMenuVertical",size:"16"}});function Ee(){return e[11](e[16])}let g=e[16].dead_at&&Qe(e);k=new Et({props:{id:e[16].id}}),k.$on("itemsChanged",e[6]);function G($,C){return $[0].type==="DEAD"?Dt:kt}let le=G(e),U=le(e);return{c(){t=d("tr"),n=d("td"),a=d("div"),s=d("button"),i=d("span"),i.textContent=_,v=L(),pe(o.$$.fragment),p=L(),h=d("menu"),r=d("ul"),g&&g.c(),b=L(),P=d("li"),pe(k.$$.fragment),te=L(),w=d("a"),E=Q(J),K=L(),R=d("td"),ae=Q(M),se=L(),A=d("td"),U.c(),ie=L(),this.h()},l($){t=f($,"TR",{class:!0});var C=y(t);n=f(C,"TD",{class:!0});var Y=y(n);a=f(Y,"DIV",{class:!0});var H=y(a);s=f(H,"BUTTON",{class:!0});var Z=y(s);i=f(Z,"SPAN",{class:!0,"data-svelte-h":!0}),ne(i)!=="svelte-1agpmtc"&&(i.textContent=_),v=N(Z),he(o.$$.fragment,Z),Z.forEach(u),p=N(H),h=f(H,"MENU",{class:!0});var de=y(h);r=f(de,"UL",{});var S=y(r);g&&g.l(S),b=N(S),P=f(S,"LI",{class:!0});var fe=y(P);he(k.$$.fragment,fe),fe.forEach(u),S.forEach(u),de.forEach(u),te=N(H),w=f(H,"A",{href:!0,class:!0});var ye=y(w);E=W(ye,J),ye.forEach(u),H.forEach(u),Y.forEach(u),K=N(C),R=f(C,"TD",{class:!0});var $e=y(R);ae=W($e,M),$e.forEach(u),se=N(C),A=f(C,"TD",{class:!0});var re=y(A);U.l(re),re.forEach(u),ie=N(C),C.forEach(u),this.h()},h(){c(i,"class","label"),c(s,"class","button compact more svelte-1m1ug4d"),c(P,"class","svelte-1m1ug4d"),c(h,"class","content-context svelte-1m1ug4d"),Je(h,"active",e[2].id===e[16].id),c(w,"href",j="/backgroundJobs/"+e[0].type.toLowerCase()+"/"+e[16].id+"?"+e[4].url.searchParams.toString()),c(w,"class","svelte-1m1ug4d"),c(a,"class","svelte-1m1ug4d"),c(n,"class","id svelte-1m1ug4d"),c(R,"class","svelte-1m1ug4d"),c(A,"class","svelte-1m1ug4d"),c(t,"class","svelte-1m1ug4d")},m($,C){X($,t,C),l(t,n),l(n,a),l(a,s),l(s,i),l(s,v),ge(o,s,null),l(a,p),l(a,h),l(h,r),g&&g.m(r,null),l(r,b),l(r,P),ge(k,P,null),l(a,te),l(a,w),l(w,E),l(t,K),l(t,R),l(R,ae),l(t,se),l(t,A),U.m(A,null),l(t,ie),q=!0,V||(ue=[me(s,"click",Ee),me(n,"mouseleave",e[12])],V=!0)},p($,C){e=$,e[16].dead_at?g?(g.p(e,C),C&2&&F(g,1)):(g=Qe(e),g.c(),F(g,1),g.m(r,b)):g&&(xe(),z(g,1,1,()=>{g=null}),Ze());const Y={};C&2&&(Y.id=e[16].id),k.$set(Y),(!q||C&6)&&Je(h,"active",e[2].id===e[16].id),(!q||C&2)&&J!==(J=(e[16].source_name||e[16].id)+"")&&De(E,J),(!q||C&19&&j!==(j="/backgroundJobs/"+e[0].type.toLowerCase()+"/"+e[16].id+"?"+e[4].url.searchParams.toString()))&&c(w,"href",j),(!q||C&2)&&M!==(M=e[16].queue+"")&&De(ae,M),le===(le=G(e))&&U?U.p(e,C):(U.d(1),U=le(e),U&&(U.c(),U.m(A,null)))},i($){q||(F(o.$$.fragment,$),F(g),F(k.$$.fragment,$),q=!0)},o($){z(o.$$.fragment,$),z(g),z(k.$$.fragment,$),q=!1},d($){$&&u(t),ve(o),g&&g.d(),ve(k),U.d(),V=!1,Ye(ue)}}}function Ct(e){var Be;let t,n,a,s,i,_,v,o,p="Type:",h,r,b,P="Scheduled",k,te="Failed",w,J="Running",E,j,K,R,M,ae="Name / id",se,A,ie="Priority",q,V,ue,Ee,g,G,le="Page:",U,$,C,Y,H=(e[1].total_pages||1)+"",Z,de,S,fe,ye;document.title=t="Jobs"+((Be=e[5].online)!=null&&Be.MPKIT_URL?": "+e[5].online.MPKIT_URL.replace("https://",""):"");function $e(m,T){return m[0].type==="DEAD"?$t:yt}let re=$e(e),x=re(e),oe=Ke(e[1].results),D=[];for(let m=0;m<oe.length;m+=1)D[m]=We(Ge(e,oe,m));const et=m=>z(D[m],1,1,()=>{D[m]=null});function tt(m){e[13](m)}let Oe={form:"filters",name:"page",min:1,max:e[1].total_pages,step:1,decreaseLabel:"Previous page",increaseLabel:"Next page",style:"navigation"};e[0].page!==void 0&&(Oe.value=e[0].page),$=new mt({props:Oe}),Le.push(()=>ct($,"value",tt)),$.$on("input",function(){He(e[3].requestSubmit())&&e[3].requestSubmit().apply(this,arguments)});const Ne=e[8].default,O=nt(Ne,e,e[7],null);return{c(){n=L(),a=d("div"),s=d("div"),i=d("nav"),_=d("form"),v=d("fieldset"),o=d("label"),o.textContent=p,h=L(),r=d("select"),b=d("option"),b.textContent=P,k=d("option"),k.textContent=te,w=d("option"),w.textContent=J,E=L(),j=d("table"),K=d("thead"),R=d("tr"),M=d("th"),M.textContent=ae,se=L(),A=d("th"),A.textContent=ie,q=L(),V=d("th"),x.c(),ue=L();for(let m=0;m<D.length;m+=1)D[m].c();Ee=L(),g=d("nav"),G=d("label"),G.textContent=le,U=L(),pe($.$$.fragment),Y=Q(`\r
      of `),Z=Q(H),de=L(),O&&O.c(),this.h()},l(m){at("svelte-qj8tye",document.head).forEach(u),n=N(m),a=f(m,"DIV",{class:!0});var B=y(a);s=f(B,"DIV",{class:!0});var ee=y(s);i=f(ee,"NAV",{class:!0});var I=y(i);_=f(I,"FORM",{id:!0,class:!0});var ke=y(_);v=f(ke,"FIELDSET",{class:!0});var Te=y(v);o=f(Te,"LABEL",{for:!0,"data-svelte-h":!0}),ne(o)!=="svelte-iw296f"&&(o.textContent=p),h=N(Te),r=f(Te,"SELECT",{name:!0,id:!0});var we=y(r);b=f(we,"OPTION",{"data-svelte-h":!0}),ne(b)!=="svelte-1nu502o"&&(b.textContent=P),k=f(we,"OPTION",{"data-svelte-h":!0}),ne(k)!=="svelte-105yz3n"&&(k.textContent=te),w=f(we,"OPTION",{"data-svelte-h":!0}),ne(w)!=="svelte-o8mv68"&&(w.textContent=J),we.forEach(u),Te.forEach(u),ke.forEach(u),I.forEach(u),E=N(ee),j=f(ee,"TABLE",{class:!0});var Ie=y(j);K=f(Ie,"THEAD",{class:!0});var Fe=y(K);R=f(Fe,"TR",{});var ce=y(R);M=f(ce,"TH",{class:!0,"data-svelte-h":!0}),ne(M)!=="svelte-17wqap5"&&(M.textContent=ae),se=N(ce),A=f(ce,"TH",{class:!0,"data-svelte-h":!0}),ne(A)!=="svelte-wgplya"&&(A.textContent=ie),q=N(ce),V=f(ce,"TH",{class:!0});var qe=y(V);x.l(qe),qe.forEach(u),ce.forEach(u),Fe.forEach(u),ue=N(Ie);for(let Re=0;Re<D.length;Re+=1)D[Re].l(Ie);Ie.forEach(u),Ee=N(ee),g=f(ee,"NAV",{class:!0});var _e=y(g);G=f(_e,"LABEL",{for:!0,"data-svelte-h":!0}),ne(G)!=="svelte-1r8oyu6"&&(G.textContent=le),U=N(_e),he($.$$.fragment,_e),Y=W(_e,`\r
      of `),Z=W(_e,H),_e.forEach(u),ee.forEach(u),de=N(B),O&&O.l(B),B.forEach(u),this.h()},h(){c(o,"for","filter-type"),b.__value="SCHEDULED",Pe(b,b.__value),k.__value="DEAD",Pe(k,k.__value),w.__value="RUNNING",Pe(w,w.__value),c(r,"name","type"),c(r,"id","filter-type"),e[0].type===void 0&&st(()=>e[9].call(r)),c(v,"class","svelte-1m1ug4d"),c(_,"id","filters"),c(_,"class","svelte-1m1ug4d"),c(i,"class","filters svelte-1m1ug4d"),c(M,"class","id svelte-1m1ug4d"),c(A,"class","svelte-1m1ug4d"),c(V,"class","svelte-1m1ug4d"),c(K,"class","svelte-1m1ug4d"),c(j,"class","svelte-1m1ug4d"),c(G,"for","page"),c(g,"class","pagination svelte-1m1ug4d"),c(s,"class","svelte-1m1ug4d"),c(a,"class","container svelte-1m1ug4d")},m(m,T){X(m,n,T),X(m,a,T),l(a,s),l(s,i),l(i,_),l(_,v),l(v,o),l(v,h),l(v,r),l(r,b),l(r,k),l(r,w),Ve(r,e[0].type,!0),e[10](_),l(s,E),l(s,j),l(j,K),l(K,R),l(R,M),l(R,se),l(R,A),l(R,q),l(R,V),x.m(V,null),l(j,ue);for(let B=0;B<D.length;B+=1)D[B]&&D[B].m(j,null);l(s,Ee),l(s,g),l(g,G),l(g,U),ge($,g,null),l(g,Y),l(g,Z),l(a,de),O&&O.m(a,null),S=!0,fe||(ye=[me(r,"change",e[9]),me(r,"change",function(){He(e[3].requestSubmit())&&e[3].requestSubmit().apply(this,arguments)})],fe=!0)},p(m,[T]){var ee;if(e=m,(!S||T&32)&&t!==(t="Jobs"+((ee=e[5].online)!=null&&ee.MPKIT_URL?": "+e[5].online.MPKIT_URL.replace("https://",""):""))&&(document.title=t),T&1&&Ve(r,e[0].type),re!==(re=$e(e))&&(x.d(1),x=re(e),x&&(x.c(),x.m(V,null))),T&87){oe=Ke(e[1].results);let I;for(I=0;I<oe.length;I+=1){const ke=Ge(e,oe,I);D[I]?(D[I].p(ke,T),F(D[I],1)):(D[I]=We(ke),D[I].c(),F(D[I],1),D[I].m(j,null))}for(xe(),I=oe.length;I<D.length;I+=1)et(I);Ze()}const B={};T&2&&(B.max=e[1].total_pages),!C&&T&1&&(C=!0,B.value=e[0].page,lt(()=>C=!1)),$.$set(B),(!S||T&2)&&H!==(H=(e[1].total_pages||1)+"")&&De(Z,H),O&&O.p&&(!S||T&128)&&rt(O,Ne,e,e[7],S?it(Ne,e[7],T,null):ot(e[7]),null)},i(m){if(!S){for(let T=0;T<oe.length;T+=1)F(D[T]);F($.$$.fragment,m),F(O,m),S=!0}},o(m){D=D.filter(Boolean);for(let T=0;T<D.length;T+=1)z(D[T]);z($.$$.fragment,m),z(O,m),S=!1},d(m){m&&(u(n),u(a)),e[10](null),x.d(),ut(D,m),ve($),O&&O.d(m),fe=!1,Ye(ye)}}}function Tt(e,t,n){let a,s;ze(e,_t,E=>n(4,a=E)),ze(e,Ce,E=>n(5,s=E));let{$$slots:i={},$$scope:_}=t,v={results:[]},o={id:null},p={page:1,type:"SCHEDULED",...Object.fromEntries(a.url.searchParams)},h,r;const b=async()=>{clearInterval(r),n(1,v=await Me.get(p)),r=setInterval(()=>{v.results.forEach(E=>{p.type==="DEAD"?E.dead_at_parsed=be(new Date(E.dead_at)):E.run_at_parsed=be(new Date(E.run_at))})},1e3)};dt(()=>{clearInterval(r)});function P(){p.type=ft(this),n(0,p)}function k(E){Le[E?"unshift":"push"](()=>{h=E,n(3,h)})}const te=E=>n(2,o.id=E.id,o),w=()=>n(2,o.id=null,o);function J(E){e.$$.not_equal(p.page,E)&&(p.page=E,n(0,p))}return e.$$set=E=>{"$$scope"in E&&n(7,_=E.$$scope)},e.$$.update=()=>{e.$$.dirty&1&&p&&b()},[p,v,o,h,a,s,b,_,i,P,k,te,w,J]}class Mt extends Ue{constructor(t){super(),je(this,t,Tt,Ct,Ae,{})}}export{Mt as component};
