import{s as Ae,e as d,a as L,t as Z,c as f,b as y,g as N,d as Q,f as u,y as c,i as W,h as l,C as me,L as We,z as Le,Z as He,l as at,p as nt,A as ae,B as Pe,M as st,a1 as Ve,D as lt,j as De,u as rt,m as ot,o as it,F as ut,r as Xe,k as ze,a2 as dt,G as Je,a3 as ft}from"../chunks/scheduler.CKQ5dLhN.js";import{S as Ue,i as je,c as pe,d as he,m as ge,t as F,a as z,f as ve,b as ct,e as Ye,g as xe}from"../chunks/index.CGVWAVV-.js";import{e as Ke}from"../chunks/each.BWzj3zy9.js";import"../chunks/entry.COceLI_i.js";import{p as _t}from"../chunks/stores.BLuxmlax.js";import{b as Me}from"../chunks/backgroundJob.cWe0itmY.js";import{s as Ce}from"../chunks/state.nqMW8J5l.js";import{I as Se}from"../chunks/Icon.CkKwi_WD.js";import{N as mt}from"../chunks/Number.B4JDnNHn.js";const be=e=>{const t=e instanceof Date?e:new Date(e),a=new Intl.RelativeTimeFormat("en"),n={years:3600*24*365,months:3600*24*30,weeks:3600*24*7,days:3600*24,hours:3600,minutes:60,seconds:1},s=(t.getTime()-Date.now())/1e3;for(let i in n)if(n[i]<Math.abs(s)){const _=s/n[i];return a.format(Math.round(_),i)}};function pt(e){let t,a,n,s,i,_,v,o,p;return i=new Se({props:{icon:"refresh",size:"22"}}),{c(){t=d("form"),a=d("input"),n=L(),s=d("button"),pe(i.$$.fragment),_=Z(`\r
    Retry`),this.h()},l(h){t=f(h,"FORM",{});var r=y(t);a=f(r,"INPUT",{type:!0,name:!0}),n=N(r),s=f(r,"BUTTON",{class:!0});var b=y(s);he(i.$$.fragment,b),_=Q(b,`\r
    Retry`),b.forEach(u),r.forEach(u),this.h()},h(){c(a,"type","hidden"),c(a,"name","id"),a.value=e[0],c(s,"class","danger")},m(h,r){W(h,t,r),l(t,a),l(t,n),l(t,s),ge(i,s,null),l(s,_),e[3](t),v=!0,o||(p=me(t,"submit",e[2]),o=!0)},p(h,[r]){(!v||r&1)&&(a.value=h[0])},i(h){v||(F(i.$$.fragment,h),v=!0)},o(h){z(i.$$.fragment,h),v=!1},d(h){h&&u(t),ve(i),e[3](null),o=!1,p()}}}function ht(e,t,a){let{id:n}=t,s;const i=We(),_=async o=>{o.preventDefault();const p=await Me.retry({properties:new FormData(s)});p.errors?Ce.notification.create("error",`Background job ${p.admin_background_job_retry.id} could not be run again`):(i("itemsChanged"),Ce.notification.create("success",`Background job ${p.admin_background_job_retry.id} planned to run again`))};function v(o){Le[o?"unshift":"push"](()=>{s=o,a(1,s)})}return e.$$set=o=>{"id"in o&&a(0,n=o.id)},[n,s,_,v]}class gt extends Ue{constructor(t){super(),je(this,t,ht,pt,Ae,{id:0})}}function vt(e){let t,a,n,s,i,_,v,o,p,h;return _=new Se({props:{icon:"x",size:"22"}}),{c(){t=d("form"),a=d("input"),n=L(),s=d("button"),i=d("i"),pe(_.$$.fragment),v=Z(`\r
    Delete background job`),this.h()},l(r){t=f(r,"FORM",{});var b=y(t);a=f(b,"INPUT",{type:!0,name:!0}),n=N(b),s=f(b,"BUTTON",{class:!0});var P=y(s);i=f(P,"I",{class:!0});var k=y(i);he(_.$$.fragment,k),k.forEach(u),v=Q(P,`\r
    Delete background job`),P.forEach(u),b.forEach(u),this.h()},h(){c(a,"type","hidden"),c(a,"name","id"),a.value=e[0],c(i,"class","svelte-ooaugn"),c(s,"class","danger")},m(r,b){W(r,t,b),l(t,a),l(t,n),l(t,s),l(s,i),ge(_,i,null),l(s,v),e[3](t),o=!0,p||(h=me(t,"submit",e[2]),p=!0)},p(r,[b]){(!o||b&1)&&(a.value=r[0])},i(r){o||(F(_.$$.fragment,r),o=!0)},o(r){z(_.$$.fragment,r),o=!1},d(r){r&&u(t),ve(_),e[3](null),p=!1,h()}}}function bt(e,t,a){let{id:n}=t,s;const i=We(),_=async o=>{if(o.preventDefault(),confirm("Are you sure you want to delete this background job?")){const p=await Me.delete({properties:new FormData(s)});p.errors?Ce.notification.create("error",`Background job ${p.admin_background_job_delete.id} could not be deleted`):(i("itemsChanged"),Ce.notification.create("success",`Background job ${p.admin_background_job_delete.id} deleted`))}};function v(o){Le[o?"unshift":"push"](()=>{s=o,a(1,s)})}return e.$$set=o=>{"id"in o&&a(0,n=o.id)},[n,s,_,v]}class Et extends Ue{constructor(t){super(),je(this,t,bt,vt,Ae,{id:0})}}function Ge(e,t,a){const n=e.slice();return n[16]=t[a],n}function yt(e){let t;return{c(){t=Z("Runs")},l(a){t=Q(a,"Runs")},m(a,n){W(a,t,n)},d(a){a&&u(t)}}}function $t(e){let t;return{c(){t=Z("Failed")},l(a){t=Q(a,"Failed")},m(a,n){W(a,t,n)},d(a){a&&u(t)}}}function Ze(e){let t,a,n;return a=new gt({props:{id:e[16].id}}),a.$on("itemsChanged",e[6]),{c(){t=d("li"),pe(a.$$.fragment),this.h()},l(s){t=f(s,"LI",{class:!0});var i=y(t);he(a.$$.fragment,i),i.forEach(u),this.h()},h(){c(t,"class","svelte-1m1ug4d")},m(s,i){W(s,t,i),ge(a,t,null),n=!0},p(s,i){const _={};i&2&&(_.id=s[16].id),a.$set(_)},i(s){n||(F(a.$$.fragment,s),n=!0)},o(s){z(a.$$.fragment,s),n=!1},d(s){s&&u(t),ve(a)}}}function kt(e){let t=(e[16].run_at_parsed||be(new Date(e[16].run_at)))+"",a;return{c(){a=Z(t)},l(n){a=Q(n,t)},m(n,s){W(n,a,s)},p(n,s){s&2&&t!==(t=(n[16].run_at_parsed||be(new Date(n[16].run_at)))+"")&&De(a,t)},d(n){n&&u(a)}}}function Dt(e){let t=(e[16].dead_at_parsed||be(new Date(e[16].dead_at))||"")+"",a;return{c(){a=Z(t)},l(n){a=Q(n,t)},m(n,s){W(n,a,s)},p(n,s){s&2&&t!==(t=(n[16].dead_at_parsed||be(new Date(n[16].dead_at))||"")+"")&&De(a,t)},d(n){n&&u(a)}}}function Qe(e){let t,a,n,s,i,_="More options",v,o,p,h,r,b,P,k,te,w,J=(e[16].source_name||e[16].id)+"",E,j,K,R,M=e[16].queue+"",ne,se,A,ie,q,V,ue;o=new Se({props:{icon:"navigationMenuVertical",size:"16"}});function Ee(){return e[11](e[16])}let g=e[16].dead_at&&Ze(e);k=new Et({props:{id:e[16].id}}),k.$on("itemsChanged",e[6]);function G($,C){return $[0].type==="DEAD"?Dt:kt}let le=G(e),U=le(e);return{c(){t=d("tr"),a=d("td"),n=d("div"),s=d("button"),i=d("span"),i.textContent=_,v=L(),pe(o.$$.fragment),p=L(),h=d("menu"),r=d("ul"),g&&g.c(),b=L(),P=d("li"),pe(k.$$.fragment),te=L(),w=d("a"),E=Z(J),K=L(),R=d("td"),ne=Z(M),se=L(),A=d("td"),U.c(),ie=L(),this.h()},l($){t=f($,"TR",{class:!0});var C=y(t);a=f(C,"TD",{class:!0});var X=y(a);n=f(X,"DIV",{class:!0});var H=y(n);s=f(H,"BUTTON",{class:!0});var Y=y(s);i=f(Y,"SPAN",{class:!0,"data-svelte-h":!0}),ae(i)!=="svelte-1agpmtc"&&(i.textContent=_),v=N(Y),he(o.$$.fragment,Y),Y.forEach(u),p=N(H),h=f(H,"MENU",{class:!0});var de=y(h);r=f(de,"UL",{});var S=y(r);g&&g.l(S),b=N(S),P=f(S,"LI",{class:!0});var fe=y(P);he(k.$$.fragment,fe),fe.forEach(u),S.forEach(u),de.forEach(u),te=N(H),w=f(H,"A",{href:!0,class:!0});var ye=y(w);E=Q(ye,J),ye.forEach(u),H.forEach(u),X.forEach(u),K=N(C),R=f(C,"TD",{class:!0});var $e=y(R);ne=Q($e,M),$e.forEach(u),se=N(C),A=f(C,"TD",{class:!0});var re=y(A);U.l(re),re.forEach(u),ie=N(C),C.forEach(u),this.h()},h(){c(i,"class","label"),c(s,"class","button compact more svelte-1m1ug4d"),c(P,"class","svelte-1m1ug4d"),c(h,"class","content-context svelte-1m1ug4d"),Je(h,"active",e[2].id===e[16].id),c(w,"href",j="/backgroundJobs/"+e[0].type.toLowerCase()+"/"+e[16].id+"?"+e[4].url.searchParams.toString()),c(w,"class","svelte-1m1ug4d"),c(n,"class","svelte-1m1ug4d"),c(a,"class","id svelte-1m1ug4d"),c(R,"class","svelte-1m1ug4d"),c(A,"class","svelte-1m1ug4d"),c(t,"class","svelte-1m1ug4d")},m($,C){W($,t,C),l(t,a),l(a,n),l(n,s),l(s,i),l(s,v),ge(o,s,null),l(n,p),l(n,h),l(h,r),g&&g.m(r,null),l(r,b),l(r,P),ge(k,P,null),l(n,te),l(n,w),l(w,E),l(t,K),l(t,R),l(R,ne),l(t,se),l(t,A),U.m(A,null),l(t,ie),q=!0,V||(ue=[me(s,"click",Ee),me(a,"mouseleave",e[12])],V=!0)},p($,C){e=$,e[16].dead_at?g?(g.p(e,C),C&2&&F(g,1)):(g=Ze(e),g.c(),F(g,1),g.m(r,b)):g&&(xe(),z(g,1,1,()=>{g=null}),Ye());const X={};C&2&&(X.id=e[16].id),k.$set(X),(!q||C&6)&&Je(h,"active",e[2].id===e[16].id),(!q||C&2)&&J!==(J=(e[16].source_name||e[16].id)+"")&&De(E,J),(!q||C&19&&j!==(j="/backgroundJobs/"+e[0].type.toLowerCase()+"/"+e[16].id+"?"+e[4].url.searchParams.toString()))&&c(w,"href",j),(!q||C&2)&&M!==(M=e[16].queue+"")&&De(ne,M),le===(le=G(e))&&U?U.p(e,C):(U.d(1),U=le(e),U&&(U.c(),U.m(A,null)))},i($){q||(F(o.$$.fragment,$),F(g),F(k.$$.fragment,$),q=!0)},o($){z(o.$$.fragment,$),z(g),z(k.$$.fragment,$),q=!1},d($){$&&u(t),ve(o),g&&g.d(),ve(k),U.d(),V=!1,Xe(ue)}}}function Ct(e){var Be;let t,a,n,s,i,_,v,o,p="Type:",h,r,b,P="Scheduled",k,te="Failed",w,J="Running",E,j,K,R,M,ne="Name / id",se,A,ie="Priority",q,V,ue,Ee,g,G,le="Page:",U,$,C,X,H=(e[1].total_pages||1)+"",Y,de,S,fe,ye;document.title=t="Jobs"+((Be=e[5].online)!=null&&Be.MPKIT_URL?": "+e[5].online.MPKIT_URL.replace("https://",""):"");function $e(m,T){return m[0].type==="DEAD"?$t:yt}let re=$e(e),x=re(e),oe=Ke(e[1].results),D=[];for(let m=0;m<oe.length;m+=1)D[m]=Qe(Ge(e,oe,m));const et=m=>z(D[m],1,1,()=>{D[m]=null});function tt(m){e[13](m)}let Oe={form:"filters",name:"page",min:1,max:e[1].total_pages,step:1,decreaseLabel:"Previous page",increaseLabel:"Next page",style:"navigation"};e[0].page!==void 0&&(Oe.value=e[0].page),$=new mt({props:Oe}),Le.push(()=>ct($,"value",tt)),$.$on("input",function(){He(e[3].requestSubmit())&&e[3].requestSubmit().apply(this,arguments)});const Ne=e[8].default,O=at(Ne,e,e[7],null);return{c(){a=L(),n=d("div"),s=d("div"),i=d("nav"),_=d("form"),v=d("fieldset"),o=d("label"),o.textContent=p,h=L(),r=d("select"),b=d("option"),b.textContent=P,k=d("option"),k.textContent=te,w=d("option"),w.textContent=J,E=L(),j=d("table"),K=d("thead"),R=d("tr"),M=d("th"),M.textContent=ne,se=L(),A=d("th"),A.textContent=ie,q=L(),V=d("th"),x.c(),ue=L();for(let m=0;m<D.length;m+=1)D[m].c();Ee=L(),g=d("nav"),G=d("label"),G.textContent=le,U=L(),pe($.$$.fragment),X=Z(`\r
      of `),Y=Z(H),de=L(),O&&O.c(),this.h()},l(m){nt("svelte-qj8tye",document.head).forEach(u),a=N(m),n=f(m,"DIV",{class:!0});var B=y(n);s=f(B,"DIV",{class:!0});var ee=y(s);i=f(ee,"NAV",{class:!0});var I=y(i);_=f(I,"FORM",{id:!0,class:!0});var ke=y(_);v=f(ke,"FIELDSET",{class:!0});var Te=y(v);o=f(Te,"LABEL",{for:!0,"data-svelte-h":!0}),ae(o)!=="svelte-iw296f"&&(o.textContent=p),h=N(Te),r=f(Te,"SELECT",{name:!0,id:!0});var we=y(r);b=f(we,"OPTION",{"data-svelte-h":!0}),ae(b)!=="svelte-1nu502o"&&(b.textContent=P),k=f(we,"OPTION",{"data-svelte-h":!0}),ae(k)!=="svelte-105yz3n"&&(k.textContent=te),w=f(we,"OPTION",{"data-svelte-h":!0}),ae(w)!=="svelte-o8mv68"&&(w.textContent=J),we.forEach(u),Te.forEach(u),ke.forEach(u),I.forEach(u),E=N(ee),j=f(ee,"TABLE",{class:!0});var Ie=y(j);K=f(Ie,"THEAD",{class:!0});var Fe=y(K);R=f(Fe,"TR",{});var ce=y(R);M=f(ce,"TH",{class:!0,"data-svelte-h":!0}),ae(M)!=="svelte-17wqap5"&&(M.textContent=ne),se=N(ce),A=f(ce,"TH",{class:!0,"data-svelte-h":!0}),ae(A)!=="svelte-wgplya"&&(A.textContent=ie),q=N(ce),V=f(ce,"TH",{class:!0});var qe=y(V);x.l(qe),qe.forEach(u),ce.forEach(u),Fe.forEach(u),ue=N(Ie);for(let Re=0;Re<D.length;Re+=1)D[Re].l(Ie);Ie.forEach(u),Ee=N(ee),g=f(ee,"NAV",{class:!0});var _e=y(g);G=f(_e,"LABEL",{for:!0,"data-svelte-h":!0}),ae(G)!=="svelte-1r8oyu6"&&(G.textContent=le),U=N(_e),he($.$$.fragment,_e),X=Q(_e,`\r
      of `),Y=Q(_e,H),_e.forEach(u),ee.forEach(u),de=N(B),O&&O.l(B),B.forEach(u),this.h()},h(){c(o,"for","filter-type"),b.__value="SCHEDULED",Pe(b,b.__value),k.__value="DEAD",Pe(k,k.__value),w.__value="RUNNING",Pe(w,w.__value),c(r,"name","type"),c(r,"id","filter-type"),e[0].type===void 0&&st(()=>e[9].call(r)),c(v,"class","svelte-1m1ug4d"),c(_,"id","filters"),c(_,"class","svelte-1m1ug4d"),c(i,"class","filters svelte-1m1ug4d"),c(M,"class","id svelte-1m1ug4d"),c(A,"class","svelte-1m1ug4d"),c(V,"class","svelte-1m1ug4d"),c(K,"class","svelte-1m1ug4d"),c(j,"class","svelte-1m1ug4d"),c(G,"for","page"),c(g,"class","pagination svelte-1m1ug4d"),c(s,"class","svelte-1m1ug4d"),c(n,"class","container svelte-1m1ug4d")},m(m,T){W(m,a,T),W(m,n,T),l(n,s),l(s,i),l(i,_),l(_,v),l(v,o),l(v,h),l(v,r),l(r,b),l(r,k),l(r,w),Ve(r,e[0].type,!0),e[10](_),l(s,E),l(s,j),l(j,K),l(K,R),l(R,M),l(R,se),l(R,A),l(R,q),l(R,V),x.m(V,null),l(j,ue);for(let B=0;B<D.length;B+=1)D[B]&&D[B].m(j,null);l(s,Ee),l(s,g),l(g,G),l(g,U),ge($,g,null),l(g,X),l(g,Y),l(n,de),O&&O.m(n,null),S=!0,fe||(ye=[me(r,"change",e[9]),me(r,"change",function(){He(e[3].requestSubmit())&&e[3].requestSubmit().apply(this,arguments)})],fe=!0)},p(m,[T]){var ee;if(e=m,(!S||T&32)&&t!==(t="Jobs"+((ee=e[5].online)!=null&&ee.MPKIT_URL?": "+e[5].online.MPKIT_URL.replace("https://",""):""))&&(document.title=t),T&1&&Ve(r,e[0].type),re!==(re=$e(e))&&(x.d(1),x=re(e),x&&(x.c(),x.m(V,null))),T&87){oe=Ke(e[1].results);let I;for(I=0;I<oe.length;I+=1){const ke=Ge(e,oe,I);D[I]?(D[I].p(ke,T),F(D[I],1)):(D[I]=Qe(ke),D[I].c(),F(D[I],1),D[I].m(j,null))}for(xe(),I=oe.length;I<D.length;I+=1)et(I);Ye()}const B={};T&2&&(B.max=e[1].total_pages),!C&&T&1&&(C=!0,B.value=e[0].page,lt(()=>C=!1)),$.$set(B),(!S||T&2)&&H!==(H=(e[1].total_pages||1)+"")&&De(Y,H),O&&O.p&&(!S||T&128)&&rt(O,Ne,e,e[7],S?it(Ne,e[7],T,null):ot(e[7]),null)},i(m){if(!S){for(let T=0;T<oe.length;T+=1)F(D[T]);F($.$$.fragment,m),F(O,m),S=!0}},o(m){D=D.filter(Boolean);for(let T=0;T<D.length;T+=1)z(D[T]);z($.$$.fragment,m),z(O,m),S=!1},d(m){m&&(u(a),u(n)),e[10](null),x.d(),ut(D,m),ve($),O&&O.d(m),fe=!1,Xe(ye)}}}function Tt(e,t,a){let n,s;ze(e,_t,E=>a(4,n=E)),ze(e,Ce,E=>a(5,s=E));let{$$slots:i={},$$scope:_}=t,v={results:[]},o={id:null},p={page:1,type:"SCHEDULED",...Object.fromEntries(n.url.searchParams)},h,r;const b=async()=>{clearInterval(r),a(1,v=await Me.get(p)),r=setInterval(()=>{v.results.forEach(E=>{p.type==="DEAD"?E.dead_at_parsed=be(new Date(E.dead_at)):E.run_at_parsed=be(new Date(E.run_at))})},1e3)};dt(()=>{clearInterval(r)});function P(){p.type=ft(this),a(0,p)}function k(E){Le[E?"unshift":"push"](()=>{h=E,a(3,h)})}const te=E=>a(2,o.id=E.id,o),w=()=>a(2,o.id=null,o);function J(E){e.$$.not_equal(p.page,E)&&(p.page=E,a(0,p))}return e.$$set=E=>{"$$scope"in E&&a(7,_=E.$$scope)},e.$$.update=()=>{e.$$.dirty&1&&p&&b()},[p,v,o,h,n,s,b,_,i,P,k,te,w,J]}class Mt extends Ue{constructor(t){super(),je(this,t,Tt,Ct,Ae,{})}}export{Mt as component};
