import{s as Ie,f as d,a as L,l as W,g as _,h as y,c as N,m as X,d as f,j as m,i as Y,u as l,x as ce,H as ze,p as ke,I as Fe,D as Ye,J as Ze,r as oe,K as Re,B as xe,L as Me,M as et,n as ye,E as tt,F as at,G as nt,N as st,y as Ge,v as lt,O as rt,w as Ue,P as ot}from"../chunks/scheduler.bed694a1.js";import{S as Le,i as Ne,b as de,d as _e,m as me,a as q,t as z,e as he,h as it,c as Ke,g as Qe}from"../chunks/index.606d5641.js";import{e as qe}from"../chunks/each.177d9825.js";import"../chunks/singletons.a2ca0d48.js";import{p as ut}from"../chunks/stores.cde9591f.js";import{b as Se}from"../chunks/backgroundJob.c756ecec.js";import{I as Ae}from"../chunks/Icon.4ad67fd0.js";import{N as ft}from"../chunks/Number.6952118c.js";import{s as De}from"../chunks/state.88bbaa31.js";const pe=e=>{const a=e instanceof Date?e:new Date(e),t=new Intl.RelativeTimeFormat("en"),n={years:3600*24*365,months:3600*24*30,weeks:3600*24*7,days:3600*24,hours:3600,minutes:60,seconds:1},s=(a.getTime()-Date.now())/1e3;for(let r in n)if(n[r]<Math.abs(s)){const c=s/n[r];return t.format(Math.round(c),r)}};function ct(e){let a,t,n,s,r,c,p,o,b;return r=new Ae({props:{icon:"refresh",size:"22"}}),{c(){a=d("form"),t=d("input"),n=L(),s=d("button"),de(r.$$.fragment),c=W(`\r
    Retry`),this.h()},l(u){a=_(u,"FORM",{});var i=y(a);t=_(i,"INPUT",{type:!0,name:!0}),n=N(i),s=_(i,"BUTTON",{class:!0});var D=y(s);_e(r.$$.fragment,D),c=X(D,`\r
    Retry`),D.forEach(f),i.forEach(f),this.h()},h(){m(t,"type","hidden"),m(t,"name","id"),t.value=e[0],m(s,"class","danger")},m(u,i){Y(u,a,i),l(a,t),l(a,n),l(a,s),me(r,s,null),l(s,c),e[3](a),p=!0,o||(b=ce(a,"submit",e[2]),o=!0)},p(u,[i]){(!p||i&1)&&(t.value=u[0])},i(u){p||(q(r.$$.fragment,u),p=!0)},o(u){z(r.$$.fragment,u),p=!1},d(u){u&&f(a),he(r),e[3](null),o=!1,b()}}}function dt(e,a,t){let{id:n}=a,s;const r=ze(),c=async o=>{o.preventDefault();const b=await Se.retry({properties:new FormData(s)});b.errors?De.notification.create("error",`Background job ${b.admin_background_job_retry.id} could not be run again`):(r("itemsChanged"),De.notification.create("success",`Background job ${b.admin_background_job_retry.id} planned to run again`))};function p(o){ke[o?"unshift":"push"](()=>{s=o,t(1,s)})}return e.$$set=o=>{"id"in o&&t(0,n=o.id)},[n,s,c,p]}class _t extends Le{constructor(a){super(),Ne(this,a,dt,ct,Ie,{id:0})}}function mt(e){let a,t,n,s,r,c,p,o,b,u;return c=new Ae({props:{icon:"x",size:"22"}}),{c(){a=d("form"),t=d("input"),n=L(),s=d("button"),r=d("i"),de(c.$$.fragment),p=W(`\r
    Delete background job`),this.h()},l(i){a=_(i,"FORM",{});var D=y(a);t=_(D,"INPUT",{type:!0,name:!0}),n=N(D),s=_(D,"BUTTON",{class:!0});var k=y(s);r=_(k,"I",{class:!0});var S=y(r);_e(c.$$.fragment,S),S.forEach(f),p=X(k,`\r
    Delete background job`),k.forEach(f),D.forEach(f),this.h()},h(){m(t,"type","hidden"),m(t,"name","id"),t.value=e[0],m(r,"class","svelte-ooaugn"),m(s,"class","danger")},m(i,D){Y(i,a,D),l(a,t),l(a,n),l(a,s),l(s,r),me(c,r,null),l(s,p),e[3](a),o=!0,b||(u=ce(a,"submit",e[2]),b=!0)},p(i,[D]){(!o||D&1)&&(t.value=i[0])},i(i){o||(q(c.$$.fragment,i),o=!0)},o(i){z(c.$$.fragment,i),o=!1},d(i){i&&f(a),he(c),e[3](null),b=!1,u()}}}function ht(e,a,t){let{id:n}=a,s;const r=ze(),c=async o=>{if(o.preventDefault(),confirm("Are you sure you want to delete this background job?")){const b=await Se.delete({properties:new FormData(s)});b.errors?De.notification.create("error",`Background job ${b.admin_background_job_delete.id} could not be deleted`):(r("itemsChanged"),De.notification.create("success",`Background job ${b.admin_background_job_delete.id} deleted`))}};function p(o){ke[o?"unshift":"push"](()=>{s=o,t(1,s)})}return e.$$set=o=>{"id"in o&&t(0,n=o.id)},[n,s,c,p]}class pt extends Le{constructor(a){super(),Ne(this,a,ht,mt,Ie,{id:0})}}function He(e,a,t){const n=e.slice();return n[15]=a[t],n}function vt(e){let a;return{c(){a=W("Runs")},l(t){a=X(t,"Runs")},m(t,n){Y(t,a,n)},d(t){t&&f(a)}}}function gt(e){let a;return{c(){a=W("Failed")},l(t){a=X(t,"Failed")},m(t,n){Y(t,a,n)},d(t){t&&f(a)}}}function Ve(e){let a,t,n;return t=new _t({props:{id:e[15].id}}),t.$on("itemsChanged",e[5]),{c(){a=d("li"),de(t.$$.fragment),this.h()},l(s){a=_(s,"LI",{class:!0});var r=y(a);_e(t.$$.fragment,r),r.forEach(f),this.h()},h(){m(a,"class","svelte-hyom4y")},m(s,r){Y(s,a,r),me(t,a,null),n=!0},p(s,r){const c={};r&2&&(c.id=s[15].id),t.$set(c)},i(s){n||(q(t.$$.fragment,s),n=!0)},o(s){z(t.$$.fragment,s),n=!1},d(s){s&&f(a),he(t)}}}function yt(e){let a=(e[15].run_at_parsed||pe(new Date(e[15].run_at)))+"",t;return{c(){t=W(a)},l(n){t=X(n,a)},m(n,s){Y(n,t,s)},p(n,s){s&2&&a!==(a=(n[15].run_at_parsed||pe(new Date(n[15].run_at)))+"")&&ye(t,a)},d(n){n&&f(t)}}}function bt(e){let a=(e[15].dead_at_parsed||pe(new Date(e[15].dead_at))||"")+"",t;return{c(){t=W(a)},l(n){t=X(n,a)},m(n,s){Y(n,t,s)},p(n,s){s&2&&a!==(a=(n[15].dead_at_parsed||pe(new Date(n[15].dead_at))||"")+"")&&ye(t,a)},d(n){n&&f(t)}}}function Je(e){let a,t,n,s,r,c="More options",p,o,b,u,i,D,k,S,Z,I,v=(e[15].source_name||e[15].id)+"",B,H,ie,G,F=e[15].queue+"",ae,ne,A,se,V,O,K;o=new Ae({props:{icon:"navigationMenuVertical",size:"16"}});function be(){return e[10](e[15])}let E=e[15].dead_at&&Ve(e);S=new pt({props:{id:e[15].id}}),S.$on("itemsChanged",e[5]);function R(w,$){return w[0].type==="DEAD"?bt:yt}let ee=R(e),j=ee(e);return{c(){a=d("tr"),t=d("td"),n=d("div"),s=d("button"),r=d("span"),r.textContent=c,p=L(),de(o.$$.fragment),b=L(),u=d("menu"),i=d("ul"),E&&E.c(),D=L(),k=d("li"),de(S.$$.fragment),Z=L(),I=d("a"),B=W(v),ie=L(),G=d("td"),ae=W(F),ne=L(),A=d("td"),j.c(),se=L(),this.h()},l(w){a=_(w,"TR",{class:!0});var $=y(a);t=_($,"TD",{class:!0});var x=y(t);n=_(x,"DIV",{class:!0});var P=y(n);s=_(P,"BUTTON",{class:!0});var te=y(s);r=_(te,"SPAN",{class:!0,"data-svelte-h":!0}),oe(r)!=="svelte-1agpmtc"&&(r.textContent=c),p=N(te),_e(o.$$.fragment,te),te.forEach(f),b=N(P),u=_(P,"MENU",{class:!0});var ve=y(u);i=_(ve,"UL",{});var le=y(i);E&&E.l(le),D=N(le),k=_(le,"LI",{class:!0});var re=y(k);_e(S.$$.fragment,re),re.forEach(f),le.forEach(f),ve.forEach(f),Z=N(P),I=_(P,"A",{href:!0,class:!0});var J=y(I);B=X(J,v),J.forEach(f),P.forEach(f),x.forEach(f),ie=N($),G=_($,"TD",{class:!0});var Q=y(G);ae=X(Q,F),Q.forEach(f),ne=N($),A=_($,"TD",{class:!0});var g=y(A);j.l(g),g.forEach(f),se=N($),$.forEach(f),this.h()},h(){m(r,"class","label"),m(s,"class","button compact more svelte-hyom4y"),m(k,"class","svelte-hyom4y"),m(u,"class","content-context svelte-hyom4y"),Ue(u,"active",e[2].id===e[15].id),m(I,"href",H="/backgroundJobs/"+e[0].type.toLowerCase()+"/"+e[15].id+"?"+e[4].url.searchParams.toString()),m(I,"class","svelte-hyom4y"),m(n,"class","svelte-hyom4y"),m(t,"class","id svelte-hyom4y"),m(G,"class","svelte-hyom4y"),m(A,"class","svelte-hyom4y"),m(a,"class","svelte-hyom4y")},m(w,$){Y(w,a,$),l(a,t),l(t,n),l(n,s),l(s,r),l(s,p),me(o,s,null),l(n,b),l(n,u),l(u,i),E&&E.m(i,null),l(i,D),l(i,k),me(S,k,null),l(n,Z),l(n,I),l(I,B),l(a,ie),l(a,G),l(G,ae),l(a,ne),l(a,A),j.m(A,null),l(a,se),V=!0,O||(K=[ce(s,"click",be),ce(t,"mouseleave",e[11])],O=!0)},p(w,$){e=w,e[15].dead_at?E?(E.p(e,$),$&2&&q(E,1)):(E=Ve(e),E.c(),q(E,1),E.m(i,D)):E&&(Qe(),z(E,1,1,()=>{E=null}),Ke());const x={};$&2&&(x.id=e[15].id),S.$set(x),(!V||$&6)&&Ue(u,"active",e[2].id===e[15].id),(!V||$&2)&&v!==(v=(e[15].source_name||e[15].id)+"")&&ye(B,v),(!V||$&19&&H!==(H="/backgroundJobs/"+e[0].type.toLowerCase()+"/"+e[15].id+"?"+e[4].url.searchParams.toString()))&&m(I,"href",H),(!V||$&2)&&F!==(F=e[15].queue+"")&&ye(ae,F),ee===(ee=R(e))&&j?j.p(e,$):(j.d(1),j=ee(e),j&&(j.c(),j.m(A,null)))},i(w){V||(q(o.$$.fragment,w),q(E),q(S.$$.fragment,w),V=!0)},o(w){z(o.$$.fragment,w),z(E),z(S.$$.fragment,w),V=!1},d(w){w&&f(a),he(o),E&&E.d(),he(S),j.d(),O=!1,Ge(K)}}}function Et(e){let a,t,n,s,r,c,p,o="Type:",b,u,i,D="Scheduled",k,S="Failed",Z,I,v,B,H,ie="Name / id",G,F,ae="Priority",ne,A,se,V,O,K,be="Page:",E,R,ee,j,w=(e[1].total_pages||1)+"",$,x,P,te,ve;function le(h,T){return h[0].type==="DEAD"?gt:vt}let re=le(e),J=re(e),Q=qe(e[1].results),g=[];for(let h=0;h<Q.length;h+=1)g[h]=Je(He(e,Q,h));const We=h=>z(g[h],1,1,()=>{g[h]=null});function Xe(h){e[12](h)}let je={form:"filters",name:"page",min:1,max:e[1].total_pages,step:1,decreaseLabel:"Previous page",increaseLabel:"Next page",style:"navigation"};e[0].page!==void 0&&(je.value=e[0].page),R=new ft({props:je}),ke.push(()=>it(R,"value",Xe)),R.$on("input",function(){Fe(e[3].requestSubmit())&&e[3].requestSubmit().apply(this,arguments)});const Ce=e[7].default,M=Ye(Ce,e,e[6],null);return{c(){a=L(),t=d("div"),n=d("div"),s=d("nav"),r=d("form"),c=d("fieldset"),p=d("label"),p.textContent=o,b=L(),u=d("select"),i=d("option"),i.textContent=D,k=d("option"),k.textContent=S,Z=L(),I=d("table"),v=d("thead"),B=d("tr"),H=d("th"),H.textContent=ie,G=L(),F=d("th"),F.textContent=ae,ne=L(),A=d("th"),J.c(),se=L();for(let h=0;h<g.length;h+=1)g[h].c();V=L(),O=d("nav"),K=d("label"),K.textContent=be,E=L(),de(R.$$.fragment),j=W(`\r
      of `),$=W(w),x=L(),M&&M.c(),this.h()},l(h){Ze("svelte-16df4tm",document.head).forEach(f),a=N(h),t=_(h,"DIV",{class:!0});var U=y(t);n=_(U,"DIV",{class:!0});var C=y(n);s=_(C,"NAV",{class:!0});var ge=y(s);r=_(ge,"FORM",{id:!0,class:!0});var Be=y(r);c=_(Be,"FIELDSET",{class:!0});var Ee=y(c);p=_(Ee,"LABEL",{for:!0,"data-svelte-h":!0}),oe(p)!=="svelte-iw296f"&&(p.textContent=o),b=N(Ee),u=_(Ee,"SELECT",{name:!0,id:!0});var we=y(u);i=_(we,"OPTION",{"data-svelte-h":!0}),oe(i)!=="svelte-1nu502o"&&(i.textContent=D),k=_(we,"OPTION",{"data-svelte-h":!0}),oe(k)!=="svelte-105yz3n"&&(k.textContent=S),we.forEach(f),Ee.forEach(f),Be.forEach(f),ge.forEach(f),Z=N(C),I=_(C,"TABLE",{class:!0});var $e=y(I);v=_($e,"THEAD",{class:!0});var Oe=y(v);B=_(Oe,"TR",{});var ue=y(B);H=_(ue,"TH",{class:!0,"data-svelte-h":!0}),oe(H)!=="svelte-17wqap5"&&(H.textContent=ie),G=N(ue),F=_(ue,"TH",{class:!0,"data-svelte-h":!0}),oe(F)!=="svelte-wgplya"&&(F.textContent=ae),ne=N(ue),A=_(ue,"TH",{class:!0});var Pe=y(A);J.l(Pe),Pe.forEach(f),ue.forEach(f),Oe.forEach(f),se=N($e);for(let Te=0;Te<g.length;Te+=1)g[Te].l($e);$e.forEach(f),V=N(C),O=_(C,"NAV",{class:!0});var fe=y(O);K=_(fe,"LABEL",{for:!0,"data-svelte-h":!0}),oe(K)!=="svelte-1r8oyu6"&&(K.textContent=be),E=N(fe),_e(R.$$.fragment,fe),j=X(fe,`\r
      of `),$=X(fe,w),fe.forEach(f),C.forEach(f),x=N(U),M&&M.l(U),U.forEach(f),this.h()},h(){document.title="Background Jobs | platformOS",m(p,"for","filter-type"),i.__value="SCHEDULED",Re(i,i.__value),k.__value="DEAD",Re(k,k.__value),m(u,"name","type"),m(u,"id","filter-type"),e[0].type===void 0&&xe(()=>e[8].call(u)),m(c,"class","svelte-hyom4y"),m(r,"id","filters"),m(r,"class","svelte-hyom4y"),m(s,"class","filters svelte-hyom4y"),m(H,"class","id svelte-hyom4y"),m(F,"class","svelte-hyom4y"),m(A,"class","svelte-hyom4y"),m(v,"class","svelte-hyom4y"),m(I,"class","svelte-hyom4y"),m(K,"for","page"),m(O,"class","pagination svelte-hyom4y"),m(n,"class","svelte-hyom4y"),m(t,"class","container svelte-hyom4y")},m(h,T){Y(h,a,T),Y(h,t,T),l(t,n),l(n,s),l(s,r),l(r,c),l(c,p),l(c,b),l(c,u),l(u,i),l(u,k),Me(u,e[0].type,!0),e[9](r),l(n,Z),l(n,I),l(I,v),l(v,B),l(B,H),l(B,G),l(B,F),l(B,ne),l(B,A),J.m(A,null),l(I,se);for(let U=0;U<g.length;U+=1)g[U]&&g[U].m(I,null);l(n,V),l(n,O),l(O,K),l(O,E),me(R,O,null),l(O,j),l(O,$),l(t,x),M&&M.m(t,null),P=!0,te||(ve=[ce(u,"change",e[8]),ce(u,"change",function(){Fe(e[3].requestSubmit())&&e[3].requestSubmit().apply(this,arguments)})],te=!0)},p(h,[T]){if(e=h,T&1&&Me(u,e[0].type),re!==(re=le(e))&&(J.d(1),J=re(e),J&&(J.c(),J.m(A,null))),T&55){Q=qe(e[1].results);let C;for(C=0;C<Q.length;C+=1){const ge=He(e,Q,C);g[C]?(g[C].p(ge,T),q(g[C],1)):(g[C]=Je(ge),g[C].c(),q(g[C],1),g[C].m(I,null))}for(Qe(),C=Q.length;C<g.length;C+=1)We(C);Ke()}const U={};T&2&&(U.max=e[1].total_pages),!ee&&T&1&&(ee=!0,U.value=e[0].page,et(()=>ee=!1)),R.$set(U),(!P||T&2)&&w!==(w=(e[1].total_pages||1)+"")&&ye($,w),M&&M.p&&(!P||T&64)&&tt(M,Ce,e,e[6],P?nt(Ce,e[6],T,null):at(e[6]),null)},i(h){if(!P){for(let T=0;T<Q.length;T+=1)q(g[T]);q(R.$$.fragment,h),q(M,h),P=!0}},o(h){g=g.filter(Boolean);for(let T=0;T<g.length;T+=1)z(g[T]);z(R.$$.fragment,h),z(M,h),P=!1},d(h){h&&(f(a),f(t)),e[9](null),J.d(),st(g,h),he(R),M&&M.d(h),te=!1,Ge(ve)}}}function $t(e,a,t){let n;lt(e,ut,v=>t(4,n=v));let{$$slots:s={},$$scope:r}=a,c={results:[]},p={id:null},o={page:1,type:"SCHEDULED",...Object.fromEntries(n.url.searchParams)},b,u;const i=async()=>{clearInterval(u),t(1,c=await Se.get(o)),console.log(c),u=setInterval(()=>{c.results.forEach(v=>{o.type==="DEAD"?v.dead_at_parsed=pe(new Date(v.dead_at)):v.run_at_parsed=pe(new Date(v.run_at))})},1e3)};rt(()=>{clearInterval(u)});function D(){o.type=ot(this),t(0,o)}function k(v){ke[v?"unshift":"push"](()=>{b=v,t(3,b)})}const S=v=>t(2,p.id=v.id,p),Z=()=>t(2,p.id=null,p);function I(v){e.$$.not_equal(o.page,v)&&(o.page=v,t(0,o))}return e.$$set=v=>{"$$scope"in v&&t(6,r=v.$$scope)},e.$$.update=()=>{e.$$.dirty&1&&o&&i()},[o,c,p,b,n,i,r,s,D,k,S,Z,I]}class At extends Le{constructor(a){super(),Ne(this,a,$t,Et,Ie,{})}}export{At as component};
